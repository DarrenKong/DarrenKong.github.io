<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.15.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Stay hungry，stay foolish!">
<meta property="og:type" content="website">
<meta property="og:title" content="DarrenKong&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="DarrenKong&#39;s Blog">
<meta property="og:description" content="Stay hungry，stay foolish!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Darren Kong">
<meta property="article:tag" content="iOS developer, 女儿控, React, Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>DarrenKong's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">DarrenKong's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Stay hungry，stay foolish!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">19</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">20</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Darren Kong</p>
  <div class="site-description" itemprop="description">Stay hungry，stay foolish!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/DarrenKong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;DarrenKong" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kong4221@163.com" title="E-Mail → mailto:kong4221@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/26/Mac-PATH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/26/Mac-PATH/" class="post-title-link" itemprop="url">Mac PATH</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-01-26 15:39:53 / 修改时间：16:03:12" itemprop="dateCreated datePublished" datetime="2024-01-26T15:39:53+08:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Mac/" itemprop="url" rel="index"><span itemprop="name">Mac</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在 Mac 上工作, 有时候会卸载掉某个 App，可能是软件卸载姿势不对，需要手动排查 PATH 环境变量。<br>首先, 我们先看下当前的 PATH 变量:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $PATH</span><br><span class="line">/Users/darren/.rbenv/shims:/opt/theos/bin:/Users/darren/flutter/bin:/usr/local/opt/tcl-tk/bin:/usr/local/opt/icu4c/sbin:/usr/local/opt/icu4c/bin:/usr/local/opt/sqlite/bin:/usr/local/opt/python@3.8/bin:/usr/local/opt/libxml2/bin:/usr/local/opt/openssl@1.1/bin:/usr/local/opt/ruby/bin:/usr/local/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/Library/Apple/usr/bin:/Applications/Wireshark.app/Contents/MacOS</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>咦，出现了 Wireshark.app，这个 App 已经删除很久了，怎么环境变量还存在。</p>
<p>这里面有好多路径, 那么我们好奇系统启动的过程中, 最初的 PATH 是什么呢?</p>
<ul>
<li><p>MAC 上最初的 PATH 是从 &#x2F;etc&#x2F;paths 文件读的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/paths</span><br><span class="line">/usr/local/bin</span><br><span class="line">/usr/bin</span><br><span class="line">/bin</span><br><span class="line">/usr/sbin</span><br><span class="line">/sbin</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>然后, 它会把 &#x2F;etc&#x2F;path.d 里面的路径逐个添加到后面, 比如我们可以看到我的 Wireshark 路径在上面的 PATH 里:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/paths.d/</span><br><span class="line">total 24</span><br><span class="line">-rw-r--r--  1 root  wheel  23 Sep 27  2022 100-rvictl</span><br><span class="line">-rw-r--r--  1 root  wheel  18 Mar 20  2020 go</span><br><span class="line">-rw-r--r--  1 root  wheel  43 Oct 19  2021 Wireshark</span><br><span class="line"></span><br><span class="line">cat /etc/paths.d/Wireshark</span><br><span class="line">/Applications/Wireshark.app/Contents/MacOS</span><br></pre></td></tr></table></figure>
</li>
<li><p>因为目前最近几个版本的 Mac 系统使用的是 Zsh 作为默认 shell，在个人的 HOME 目录, 还有 <code>~/.zshrc</code> 文件会影响 PATH 的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 可以通过下面这个命令查看使用说明</span><br><span class="line">man zsh</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">STARTUP/SHUTDOWN FILES</span><br><span class="line">       Commands are first read from /etc/zshenv; this cannot be overridden.  Subsequent behaviour is modified by the RCS and GLOBAL_RCS options; the former affects all startup files, while the second only</span><br><span class="line">       affects global startup files (those shown here with an path starting with a /).  If one of the options is unset at any point, any subsequent startup file(s) of the corresponding type will not be read.</span><br><span class="line">       It is also possible for a file in $ZDOTDIR to re-enable GLOBAL_RCS. Both RCS and GLOBAL_RCS are set by default.</span><br><span class="line"></span><br><span class="line">       Commands are then read from $ZDOTDIR/.zshenv.  If the shell is a login shell, commands are read from /etc/zprofile and then $ZDOTDIR/.zprofile.  Then, if the shell is interactive, commands are read from</span><br><span class="line">       /etc/zshrc and then $ZDOTDIR/.zshrc.  Finally, if the shell is a login shell, /etc/zlogin and $ZDOTDIR/.zlogin are read.</span><br><span class="line"></span><br><span class="line">       When a login shell exits, the files $ZDOTDIR/.zlogout and then /etc/zlogout are read.  This happens with either an explicit exit via the exit or logout commands, or an implicit exit by reading</span><br><span class="line">       end-of-file from the terminal.  However, if the shell terminates due to exec&#x27;ing another process, the logout files are not read.  These are also affected by the RCS and GLOBAL_RCS options.  Note also</span><br><span class="line">       that the RCS option affects the saving of history files, i.e. if RCS is unset when the shell exits, no history file will be saved.</span><br><span class="line"></span><br><span class="line">       If ZDOTDIR is unset, HOME is used instead.  Files listed above as being in /etc may be in another directory, depending on the installation.</span><br><span class="line"></span><br><span class="line">       As /etc/zshenv is run for all instances of zsh, it is important that it be kept as small as possible.  In particular, it is a good idea to put code that does not need to be run for every single shell</span><br><span class="line">       behind a test of the form `if [[ -o rcs ]]; then ...&#x27; so that it will not be executed when zsh is invoked with the `-f&#x27; option.</span><br><span class="line"></span><br><span class="line">       Any of these files may be pre-compiled with the zcompile builtin command (see zshbuiltins(1)).  If a compiled file exists (named for the original file plus the .zwc extension) and it is newer than the</span><br><span class="line">       original file, the compiled file will be used instead.</span><br><span class="line"></span><br><span class="line">FILES</span><br><span class="line">       $ZDOTDIR/.zshenv</span><br><span class="line">       $ZDOTDIR/.zprofile</span><br><span class="line">       $ZDOTDIR/.zshrc</span><br><span class="line">       $ZDOTDIR/.zlogin</span><br><span class="line">       $ZDOTDIR/.zlogout</span><br><span class="line">       $&#123;TMPPREFIX&#125;*   (default is /tmp/zsh*)</span><br><span class="line">       /etc/zshenv</span><br><span class="line">       /etc/zprofile</span><br><span class="line">       /etc/zshrc</span><br><span class="line">       /etc/zlogin</span><br><span class="line">       /etc/zlogout    (installation-specific - /etc is the default)</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/25/%E4%BC%98%E9%9B%85%E5%9C%B0%E5%9C%A8-React-%E4%B8%AD%E4%BD%BF%E7%94%A8TypeScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/25/%E4%BC%98%E9%9B%85%E5%9C%B0%E5%9C%A8-React-%E4%B8%AD%E4%BD%BF%E7%94%A8TypeScript/" class="post-title-link" itemprop="url">优雅地在 React 中使用TypeScript</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-25 10:56:00" itemprop="dateCreated datePublished" datetime="2022-08-25T10:56:00+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-27 10:30:01" itemprop="dateModified" datetime="2023-09-27T10:30:01+08:00">2023-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/FE/" itemprop="url" rel="index"><span itemprop="name">FE</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>工作用的技术栈主要是 <code>React hooks</code> + <code>TypeScript</code>。使用三月有余，其实在单独使用 <code>TypeScript</code> 时没有太多的坑，不过和<code>React</code>结合之后就会复杂很多。本文就来聊一聊<code>TypeScript</code>与<code>React</code>一起使用时经常遇到的一些类型定义的问题。阅读本文前，希望你能有一定的<code>React</code>和<code>TypeScript</code>基础。</p>
</blockquote>
<h3 id="一、组件声明"><a href="#一、组件声明" class="headerlink" title="一、组件声明"></a>一、组件声明</h3><p>在<code>React</code>中，组件的声明方式有两种：函数组件和类组件， 来看看这两种类型的组件声明时是如何定义TS类型的。</p>
<h4 id="1-类组件"><a href="#1-类组件" class="headerlink" title="1. 类组件"></a>1. 类组件</h4><p>类组件的定义形式有两种：<code>React.Component&lt;P, S=&#123;&#125;&gt;</code> 和 <code>React.PureComponent&lt;P, S=&#123;&#125; SS=&#123;&#125;&gt;</code>，它们都是泛型接口，接收两个参数，第一个是<code>props</code>类型的定义，第二个是<code>state</code>类型的定义，这两个参数都不是必须的，没有时可以省略：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">interface <span class="title class_">IState</span> &#123;</span><br><span class="line">  <span class="attr">count</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">IProps</span>, <span class="title class_">IState</span>&gt; &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.state.count&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;this.props.name&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p><code>React.PureComponent&lt;P, S=&#123;&#125; SS=&#123;&#125;&gt;</code> 也是差不多的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&lt;<span class="title class_">IProps</span>, <span class="title class_">IState</span>&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>React.PureComponent</code>是有第三个参数的，它表示<code>getSnapshotBeforeUpdate</code>的返回值。</p>
<p>那<code>PureComponent</code>和<code>Component</code> 的区别是什么呢？它们的主要区别是<code>PureComponent</code>中的<code>shouldComponentUpdate</code> 是由自身进行处理的，不需要我们自己处理，所以<code>PureComponent</code>可以在一定程度上提升性能。</p>
<p>有时候可能会见到这种写法，实际上和上面的效果是一样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;<span class="title class_">PureComponent</span>, <span class="title class_">Component</span>&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span>&lt;<span class="title class_">IProps</span>, <span class="title class_">IState</span>&gt; &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span>&lt;<span class="title class_">IProps</span>, <span class="title class_">IState</span>&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>那如果定义时候我们不知道组件的<code>props</code>的类型，只有在调用时才知道组件类型，该怎么办呢？这时泛型就发挥作用了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span>&lt;P&gt; <span class="keyword">extends</span> <span class="title class_">React</span>.<span class="property">Component</span>&lt;P&gt; &#123;</span><br><span class="line">  <span class="attr">internalProp</span>: P;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props: P</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">internalProp</span> = props;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用组件</span></span><br><span class="line">type <span class="title class_">IProps</span> = &#123; <span class="attr">name</span>: string; <span class="attr">age</span>: number; &#125;;</span><br><span class="line"> </span><br><span class="line">&lt;<span class="title class_">MyComponent</span>&lt;<span class="title class_">IProps</span>&gt; name=<span class="string">&quot;React&quot;</span> age=&#123;<span class="number">18</span>&#125; /&gt;;          <span class="comment">// Success</span></span><br><span class="line">&lt;<span class="title class_">MyComponent</span>&lt;<span class="title class_">IProps</span>&gt; name=<span class="string">&quot;TypeScript&quot;</span> age=<span class="string">&quot;hello&quot;</span> /&gt;;  <span class="comment">// Error</span></span><br></pre></td></tr></table></figure>

<h4 id="2-函数组件"><a href="#2-函数组件" class="headerlink" title="2. 函数组件"></a>2. 函数组件</h4><p>通常情况下，函数组件我是这样写的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params">props: IProps</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;name&#125; = props;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>除此之外，函数类型还可以使用<code>React.FunctionComponent&lt;P=&#123;&#125;&gt;</code>来定义，也可以使用其简写<code>React.FC&lt;P=&#123;&#125;&gt;</code>，两者效果是一样的。它是一个泛型接口，可以接收一个参数，参数表示<code>props</code>的类型，这个参数不是必须的。它们就相当于这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">React</span>.<span class="property">FC</span>&lt;P = &#123;&#125;&gt; = <span class="title class_">React</span>.<span class="property">FunctionComponent</span>&lt;P&gt;</span><br></pre></td></tr></table></figure>

<p>最终的定义形式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IProps</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;name&#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>当使用这种形式来定义函数组件时，<code>props</code>中默认会带有<code>children</code>属性，它表示该组件在调用时，其内部的元素，来看一个例子，首先定义一个组件，组件中引入了<code>Child1</code>和<code>Child2</code>组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Child1</span> <span class="keyword">from</span> <span class="string">&quot;./child1&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Child2</span> <span class="keyword">from</span> <span class="string">&quot;./child2&quot;</span>;</span><br><span class="line"> </span><br><span class="line">interface <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IProps</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Child1</span> <span class="attr">name</span>=<span class="string">&#123;name&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child2</span> <span class="attr">name</span>=<span class="string">&#123;name&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      TypeScript</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Child1</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>Child1组件结构如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child1</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IProps</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name, children &#125; = props;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(children);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello child1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Child1</span>;</span><br></pre></td></tr></table></figure>

<p>我们在<code>Child1</code>组件中打印了<code>children</code>属性，它的值是一个数组，包含<code>Child2</code>对象和后面的文本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">▾ (<span class="number">2</span>) [<span class="title class_">Object</span>, <span class="string">&quot;TypeScript&quot;</span>]</span><br><span class="line"> ▸ <span class="number">0</span>: <span class="title class_">Object</span></span><br><span class="line">   <span class="number">1</span>: <span class="string">&quot;TypeScript&quot;</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>React.FC</code> 声明函数组件和普通声明的区别如下：</p>
<ul>
<li><p><code>React.FC</code> 显式地定义了返回类型，其他方式是隐式推导的；</p>
</li>
<li><p><code>React.FC</code> 对静态属性：<code>displayName</code>、<code>propTypes</code>、<code>defaultProps</code> 提供了类型检查和自动补全；</p>
</li>
<li><p><code>React.FC</code> 为 <code>children</code> 提供了隐式的类型（<code>ReactElement | null</code>）。</p>
</li>
</ul>
<p>那如果我们在定义组件时不知道<code>props</code>的类型，只有调用时才知道，那就还是用泛型来定义<code>props</code>的类型。对于使用<code>function</code>定义的函数组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title class_">MyComponent</span>&lt;P&gt;(<span class="attr">props</span>: P) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     &#123;props&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用组件</span></span><br><span class="line">type <span class="title class_">IProps</span> = &#123; <span class="attr">name</span>: string; <span class="attr">age</span>: number; &#125;;</span><br><span class="line"> </span><br><span class="line">&lt;<span class="title class_">MyComponent</span>&lt;<span class="title class_">IProps</span>&gt; name=<span class="string">&quot;React&quot;</span> age=&#123;<span class="number">18</span>&#125; /&gt;;          <span class="comment">// Success</span></span><br><span class="line">&lt;<span class="title class_">MyComponent</span>&lt;<span class="title class_">IProps</span>&gt; name=<span class="string">&quot;TypeScript&quot;</span> age=<span class="string">&quot;hello&quot;</span> /&gt;;  <span class="comment">// Error</span></span><br></pre></td></tr></table></figure>

<p>如果使用箭头函数定义的函数组件，直接这样调用是错误的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = &lt;P&gt;(<span class="attr">props</span>: P) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     &#123;props&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>必须使用<code>extends</code>关键字来定义泛型参数才能被成功解析：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = &lt;P <span class="keyword">extends</span> any&gt;(<span class="attr">props</span>: P) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     &#123;props&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二、React内置类型"><a href="#二、React内置类型" class="headerlink" title="二、React内置类型"></a>二、<code>React</code>内置类型</h3><h4 id="1-JSX-Element"><a href="#1-JSX-Element" class="headerlink" title="1. JSX.Element"></a>1. JSX.Element</h4><p>先来看看<code>JSX.Element</code>类型的声明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="variable language_">global</span> &#123;</span><br><span class="line">  namespace <span class="variable constant_">JSX</span> &#123;</span><br><span class="line">    interface <span class="title class_">Element</span> <span class="keyword">extends</span> <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;any, any&gt; &#123; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>JSX.Element</code>是<code>ReactElement</code>的子类型，它没有增加属性，两者是等价的。也就是说两种类型的变量可以相互赋值。</p>
<p><code>JSX.Element</code> 可以通过执行 <code>React.createElement</code> 或是转译 <code>JSX</code> 获得：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsx = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> ele = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-React-ReactElement"><a href="#2-React-ReactElement" class="headerlink" title="2. React.ReactElement"></a>2. React.ReactElement</h4><p><code>React</code> 的类型声明文件中提供了 <code>React.ReactElement＜T＞</code>，它可以让我们通过传入<code>＜T/＞</code>来注解类组件的实例化，它在声明文件中的定义如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">ReactElement</span>&lt;P = any, T <span class="keyword">extends</span> string | <span class="title class_">JSXElementConstructor</span>&lt;any&gt; = string | <span class="title class_">JSXElementConstructor</span>&lt;any&gt;&gt; &#123;</span><br><span class="line">   <span class="attr">type</span>: T;</span><br><span class="line">   <span class="attr">props</span>: P;</span><br><span class="line">   <span class="attr">key</span>: <span class="title class_">Key</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ReactElement</code>是一个接口，包含<code>type</code>、<code>props</code>、<code>key</code>三个属性值。该类型的变量值只能是两种：<code>null</code> 和 <code>ReactElement</code>实例。</p>
<p>通常情况下，函数组件返回<code>ReactElement（JXS.Element）</code>的值。</p>
<h4 id="3-React-ReactNode"><a href="#3-React-ReactNode" class="headerlink" title="3. React.ReactNode"></a>3. React.ReactNode</h4><p><code>ReactNode</code>类型的声明如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">ReactText</span> = string | number;</span><br><span class="line">type <span class="title class_">ReactChild</span> = <span class="title class_">ReactElement</span> | <span class="title class_">ReactText</span>;</span><br><span class="line"> </span><br><span class="line">interface <span class="title class_">ReactNodeArray</span> <span class="keyword">extends</span> <span class="title class_">Array</span>&lt;<span class="title class_">ReactNode</span>&gt; &#123;&#125;</span><br><span class="line">type <span class="title class_">ReactFragment</span> = &#123;&#125; | <span class="title class_">ReactNodeArray</span>;</span><br><span class="line">type <span class="title class_">ReactNode</span> = <span class="title class_">ReactChild</span> | <span class="title class_">ReactFragment</span> | <span class="title class_">ReactPortal</span> | boolean | <span class="literal">null</span> | <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure>
<p>可以看到，<code>ReactNode</code>是一个联合类型，它可以是<code>string</code>、<code>number</code>、<code>ReactElement</code>、<code>null</code>、<code>boolean</code>、<code>ReactNodeArray</code>。由此可知。<code>ReactElement</code>类型的变量可以直接赋值给<code>ReactNode</code>类型的变量，但反过来是不行的。</p>
<p>类组件的 <code>render</code> 成员函数会返回 <code>ReactNode</code> 类型的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">component</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>&lt;<span class="title class_">MyComponent</span>&gt; = <span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span>;</span><br><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">component</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>&lt;<span class="title class_">MyComponent</span>&gt; = <span class="language-xml"><span class="tag">&lt;<span class="name">OtherComponent</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>上面的代码中，给<code>component</code>变量设置了类型是<code>Mycomponent</code>类型的<code>React</code>实例，这时只能给其赋值其为<code>MyComponent</code>的实例组件。</p>
<p>通常情况下，类组件通过 render() 返回 ReactNode的值。</p>
<h4 id="4-CSSProperties"><a href="#4-CSSProperties" class="headerlink" title="4. CSSProperties"></a>4. CSSProperties</h4><p>先来看看<code>React</code>的声明文件中对<code>CSSProperties</code> 的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> interface <span class="title class_">CSSProperties</span> <span class="keyword">extends</span> <span class="variable constant_">CSS</span>.<span class="property">Properties</span>&lt;string | number&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The index signature was removed to enable closed typing for style</span></span><br><span class="line"><span class="comment">   * using CSSType. You&#x27;re able to use type assertion or module augmentation</span></span><br><span class="line"><span class="comment">   * to add properties or an index signature of your own.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * For examples and more information, visit:</span></span><br><span class="line"><span class="comment">   * https://github.com/frenic/csstype#what-should-i-do-when-i-get-type-errors</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>React.CSSProperties</code>是<code>React</code>基于<code>TypeScript</code>定义的<code>CSS</code>属性类型，可以将一个方法的返回值设置为该类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> classNames = <span class="built_in">require</span>(<span class="string">&quot;./sidebar.css&quot;</span>);</span><br><span class="line"> </span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">isVisible</span>: boolean;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> divStyle = (<span class="attr">props</span>: <span class="title class_">Props</span>): <span class="title class_">React</span>.<span class="property">CSSProperties</span> =&gt; (&#123;</span><br><span class="line">  <span class="attr">width</span>: props.<span class="property">isVisible</span> ? <span class="string">&quot;23rem&quot;</span> : <span class="string">&quot;0rem&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">SidebarComponent</span>: <span class="title class_">React</span>.<span class="property">StatelessComponent</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function"><span class="params">props</span> =&gt;</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;mySidenav&quot;</span> <span class="attr">className</span>=<span class="string">&#123;classNames.sidenav&#125;</span> <span class="attr">style</span>=<span class="string">&#123;divStyle(props)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>这里<code>divStyle</code>组件的返回值就是<code>React.CSSProperties</code>类型。</p>
<p>我们还可以定义一个<code>CSSProperties</code>类型的变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">divStyle</span>: <span class="title class_">React</span>.<span class="property">CSSProperties</span> = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&quot;11rem&quot;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&quot;7rem&quot;</span>,</span><br><span class="line">    <span class="attr">backgroundColor</span>: <span class="string">`rgb(<span class="subst">$&#123;props.color.red&#125;</span>,<span class="subst">$&#123;props.color.green&#125;</span>, <span class="subst">$&#123;props.color.blue&#125;</span>)`</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个变量可以在<code>HTML</code>标签的<code>style</code>属性上使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&#123;divStyle&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>React</code>的类型声明文件中，<code>style</code>属性的类型如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">style?: <span class="title class_">CSSProperties</span> | <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure>

<h3 id="三、React-Hooks"><a href="#三、React-Hooks" class="headerlink" title="三、React Hooks"></a>三、React Hooks</h3><h4 id="1-useState"><a href="#1-useState" class="headerlink" title="1. useState"></a>1. useState</h4><p>默认情况下，<code>React</code>会为根据设置的<code>state</code>的初始值来自动推导<code>state</code>以及更新函数的类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Child1</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IProps</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name, children &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> &#123; count, setCount &#125; = <span class="title function_">useState</span>(<span class="number">1</span>); <span class="comment">// const count : number</span></span><br></pre></td></tr></table></figure>
<p>如果已知state 的类型，可以通过以下形式来自定义state的类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = useState&lt;number&gt;(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>如果初始值为null，需要显式地声明 state 的类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = useState&lt;number | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>如果state是一个对象，想要初始化一个空对象，可以使用断言来处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [user, setUser] = <span class="title class_">React</span>.<span class="property">useState</span>&lt;<span class="title class_">IUser</span>&gt;(&#123;&#125; <span class="keyword">as</span> <span class="title class_">IUser</span>);</span><br></pre></td></tr></table></figure>
<p>实际上，这里将空对象{}断言为IUser接口就是欺骗了TypeScript的编译器，由于后面的代码可能会依赖这个对象，所以应该在使用前及时初始化 user 的值，否则就会报错。</p>
<p>下面是声明文件中 useState 的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useState&lt;S&gt;(<span class="attr">initialState</span>: S | (<span class="function">() =&gt;</span> S)): [S, <span class="title class_">Dispatch</span>&lt;<span class="title class_">SetStateAction</span>&lt;S&gt;&gt;];</span><br><span class="line"><span class="comment">// convenience overload when first argument is omitted</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns a stateful value, and a function to update it.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#usestate</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">function</span> useState&lt;S = <span class="literal">undefined</span>&gt;(): [S | <span class="literal">undefined</span>, <span class="title class_">Dispatch</span>&lt;<span class="title class_">SetStateAction</span>&lt;S | <span class="literal">undefined</span>&gt;&gt;];</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * An alternative to `useState`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * `useReducer` is usually preferable to `useState` when you have complex state logic that involves</span></span><br><span class="line"><span class="comment">   * multiple sub-values. It also lets you optimize performance for components that trigger deep</span></span><br><span class="line"><span class="comment">   * updates because you can pass `dispatch` down instead of callbacks.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#usereducer</span></span><br><span class="line"><span class="comment">   */</span></span><br></pre></td></tr></table></figure>
<p>  可以看到，这里定义两种形式，分别是有初始值和没有初始值的形式。</p>
<h4 id="2-useEffect"><a href="#2-useEffect" class="headerlink" title="2. useEffect"></a>2. useEffect</h4><p><code>useEffect</code>的主要作用就是处理副作用，它的第一个参数是一个函数，表示要清除副作用的操作，第二个参数是一组值，当这组值改变时，第一个参数的函数才会执行，这让我们可以控制何时运行函数来处理副作用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> subscription = props.<span class="property">source</span>.<span class="title function_">subscribe</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      subscription.<span class="title function_">unsubscribe</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  [props.<span class="property">source</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>当函数的返回值不是函数或者<code>effect</code>函数中未定义的内容时，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">subscribe</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>; </span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>TypeScript就会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Argument</span> <span class="keyword">of</span> type ‘() =&gt; &#123;‘ is not assignable to parameter <span class="keyword">of</span> type ‘<span class="title class_">EffectCallback</span>‘. </span><br><span class="line"><span class="title class_">Type</span> ‘<span class="literal">null</span>‘ is not assignable to type ‘<span class="keyword">void</span> | <span class="title class_">Destructor</span>’. <span class="title function_">ts</span>(<span class="number">2345</span>)</span><br></pre></td></tr></table></figure>
<p>来看看<code>useEffect</code>在类型声明文件中的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Destructors are only allowed to return void.</span></span><br><span class="line">type <span class="title class_">Destructor</span> = <span class="function">() =&gt;</span> <span class="keyword">void</span> | &#123; [<span class="variable constant_">UNDEFINED_VOID_ONLY</span>]: never &#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> callbacks are _only_ allowed to return either void, or a destructor.</span></span><br><span class="line">type <span class="title class_">EffectCallback</span> = <span class="function">() =&gt;</span> (<span class="keyword">void</span> | <span class="title class_">Destructor</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// TODO (TypeScript 3.0): ReadonlyArray&lt;unknown&gt;</span></span><br><span class="line">type <span class="title class_">DependencyList</span> = <span class="title class_">ReadonlyArray</span>&lt;any&gt;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useEffect</span>(<span class="params">effect: EffectCallback, deps?: DependencyList</span>): <span class="keyword">void</span>;</span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> this does not accept strings, but this will have to be fixed by removing strings from type Ref&lt;T&gt;</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * `useImperativeHandle` customizes the instance value that is exposed to parent components when using</span></span><br><span class="line"><span class="comment">   * `ref`. As always, imperative code using refs should be avoided in most cases.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * `useImperativeHandle` should be used with `React.forwardRef`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#useimperativehandle</span></span><br><span class="line"><span class="comment">   */</span></span><br></pre></td></tr></table></figure>
<p>可以看到，<code>useEffect</code>的第一个参数只允许返回一个函数。</p>
<h4 id="3-useRef"><a href="#3-useRef" class="headerlink" title="3. useRef"></a>3. useRef</h4><p>当使用 <code>useRef</code> 时，我们可以访问一个可变的引用对象。可以将初始值传递给 <code>useRef</code>，它用于初始化可变 <code>ref</code> 对象公开的当前属性。当我们使用<code>useRef</code>时，需要给其指定类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nameInput = <span class="title class_">React</span>.<span class="property">useRef</span>&lt;<span class="title class_">HTMLInputElement</span>&gt;(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>
<p>这里给实例的类型指定为了<code>input</code>输入框类型。</p>
<p>当<code>useRef</code>的初始值为<code>null</code>时，有两种创建的形式，第一种：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nameInput = <span class="title class_">React</span>.<span class="property">useRef</span>&lt;<span class="title class_">HTMLInputElement</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">nameInput.<span class="property">current</span>.<span class="property">innerText</span> = <span class="string">&quot;hello world&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>这种形式下，<code>ref1.current</code>是只读的（<code>read-only</code>），所以当我们将它的<code>innerText</code>属性重新赋值时会报以下错误：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Cannot</span> assign to <span class="string">&#x27;current&#x27;</span> because it is a read-only property.</span><br></pre></td></tr></table></figure>
<p>那该怎么将<code>current</code>属性变为动态可变的，先来看看类型声明文件中 <code>useRef</code> 是如何定义的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useRef&lt;T&gt;(<span class="attr">initialValue</span>: T): <span class="title class_">MutableRefObject</span>&lt;T&gt;;</span><br><span class="line"> <span class="comment">// convenience overload for refs given as a ref prop as they typically start with a null value</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * `useRef` returns a mutable ref object whose `.current` property is initialized to the passed argument</span></span><br><span class="line"><span class="comment">   * (`initialValue`). The returned object will persist for the full lifetime of the component.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Note that `useRef()` is useful for more than the `ref` attribute. It’s handy for keeping any mutable</span></span><br><span class="line"><span class="comment">   * value around similar to how you’d use instance fields in classes.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Usage note: if you need the result of useRef to be directly mutable, include `| null` in the type</span></span><br><span class="line"><span class="comment">   * of the generic argument.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#useref</span></span><br><span class="line"><span class="comment">   */</span></span><br></pre></td></tr></table></figure>
<p>这段代码的第十行的告诉我们，如果需要<code>useRef</code>的直接可变，就需要在泛型参数中包含<code>&#39;| null&#39;</code>，所以这就是当初始值为<code>null</code>的第二种定义形式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nameInput = <span class="title class_">React</span>.<span class="property">useRef</span>&lt;<span class="title class_">HTMLInputElement</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>这种形式下，<code>nameInput.current</code>就是可写的。不过两种类型在使用时都需要做类型检查：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameInput.<span class="property">current</span>?.<span class="property">innerText</span> = <span class="string">&quot;hello world&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>那么问题来了，为什么第一种写法在没有操作<code>current</code>时没有报错呢？因为<code>useRef</code>在类型定义时具有多个重载声明，第一种方式就是执行的以下函数重载：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useRef&lt;T&gt;(<span class="attr">initialValue</span>: T|<span class="literal">null</span>): <span class="title class_">RefObject</span>&lt;T&gt;;</span><br><span class="line"><span class="comment">// convenience overload for potentially undefined initialValue / call with 0 arguments</span></span><br><span class="line"><span class="comment">// has a default to stop it from defaulting to &#123;&#125; instead</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * `useRef` returns a mutable ref object whose `.current` property is initialized to the passed argument</span></span><br><span class="line"><span class="comment">  * (`initialValue`). The returned object will persist for the full lifetime of the component.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * Note that `useRef()` is useful for more than the `ref` attribute. It’s handy for keeping any mutable</span></span><br><span class="line"><span class="comment">  * value around similar to how you’d use instance fields in classes.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#useref</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>
<p> 从上<code>useRef</code>的声明中可以看到，<code>function useRef</code>的返回值类型化是<code>MutableRefObject</code>，这里面的T就是参数的类型T，所以最终<code>nameInput</code> 的类型就是<code>React.MutableRefObject</code>。</p>
<p>注意，上面用到了<code>HTMLInputElement</code>类型，这是一个标签类型，这个操作就是用来访问<code>DOM</code>元素的。</p>
<h4 id="4-useCallback"><a href="#4-useCallback" class="headerlink" title="4. useCallback"></a>4. useCallback</h4><p>先来看看类型声明文件中对<code>useCallback</code>的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useCallback&lt;T <span class="keyword">extends</span> (...<span class="attr">args</span>: any[]) =&gt; any&gt;(<span class="attr">callback</span>: T, <span class="attr">deps</span>: <span class="title class_">DependencyList</span>): T;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * `useMemo` will only recompute the memoized value when one of the `deps` has changed.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * Usage note: if calling `useMemo` with a referentially stable function, also give it as the input in</span></span><br><span class="line"><span class="comment">  * the second argument.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * ```ts</span></span><br><span class="line"><span class="comment">  * function expensive () &#123; ... &#125;</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * function Component () &#123;</span></span><br><span class="line"><span class="comment">  *   const expensiveResult = useMemo(expensive, [expensive])</span></span><br><span class="line"><span class="comment">  *   return ...</span></span><br><span class="line"><span class="comment">  * &#125;</span></span><br><span class="line"><span class="comment">  * ```</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#usememo</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>
<p> <code>useCallback</code>接收一个回调函数和一个依赖数组，只有当依赖数组中的值发生变化时才会重新执行回调函数。来看一个例子：<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">a: number, b: number</span>) =&gt; a + b;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> memoizedCallback = <span class="title function_">useCallback</span>(</span><br><span class="line">  <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">add</span>(a, b);</span><br><span class="line">  &#125;,</span><br><span class="line">  [b]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br>这里我们没有给回调函数中的参数<code>a</code>定义类型，所以下面的调用方式都不会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">memoizedCallback</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="title function_">memoizedCallback</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>尽管<code>add</code>方法的两个参数都是<code>number</code>类型，但是上述调用都能够用执行。所以为了更加严谨，我们需要给回调函数定义具体的类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = <span class="title function_">useCallback</span>(</span><br><span class="line">  <span class="function">(<span class="params">a: number</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">add</span>(a, b);</span><br><span class="line">  &#125;,</span><br><span class="line">  [b]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>这时候如果再给回调函数传入字符串就会报错了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Argument</span> <span class="keyword">of</span> type ‘string‘ is not assignable to parameter <span class="keyword">of</span> type ‘number‘. <span class="title function_">ts</span>(<span class="number">2345</span>)</span><br></pre></td></tr></table></figure>
<p>所有，需要注意，在使用<code>useCallback</code>时需要给回调函数的参数指定类型。</p>
<h4 id="5-useMemo"><a href="#5-useMemo" class="headerlink" title="5. useMemo"></a>5. useMemo</h4><p>先来看看类型声明文件中对<code>useMemo</code>的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useMemo&lt;T&gt;(<span class="attr">factory</span>: <span class="function">() =&gt;</span> T, <span class="attr">deps</span>: <span class="title class_">DependencyList</span> | <span class="literal">undefined</span>): T;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * `useDebugValue` can be used to display a label for custom hooks in React DevTools.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">NOTE:</span> We don’t recommend adding debug values to every custom hook.</span></span><br><span class="line"><span class="comment">    * It’s most valuable for custom hooks that are part of shared libraries.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#usedebugvalue</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure>
<p><code>useMemo</code>和<code>useCallback</code>是非常类似的，但是它返回的是一个值，而不是函数。所以在定义<code>useMemo</code>时需要定义返回值的类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  a += <span class="number">1</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> calculatedValue = useMemo&lt;number&gt;(<span class="function">() =&gt;</span> a ** <span class="number">2</span>, [a]);</span><br></pre></td></tr></table></figure>
<p>如果返回值不一致，就会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> calculatedValue = useMemo&lt;number&gt;(<span class="function">() =&gt;</span> a + <span class="string">&quot;hello&quot;</span>, [a]);</span><br><span class="line"><span class="comment">// 类型“() =&gt; string”的参数不能赋给类型“() =&gt; number”的参数</span></span><br></pre></td></tr></table></figure>

<h4 id="6-useContext"><a href="#6-useContext" class="headerlink" title="6. useContext"></a>6. useContext</h4><p><code>useContext</code>需要提供一个上下文对象，并返回所提供的上下文的值，当提供者更新上下文对象时，引用这些上下文对象的组件就会重新渲染：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ColorContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;green&quot;</span> &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Welcome</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; color &#125; = <span class="title function_">useContext</span>(<span class="title class_">ColorContext</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color</span> &#125;&#125;&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在使用<code>useContext</code>时，会自动推断出提供的上下文对象的类型，所以并不需要我们手动设置<code>context</code>的类型。当前，我们也可以使用泛型来设置<code>context</code>的类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">IColor</span> &#123;</span><br><span class="line"> <span class="attr">color</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ColorContext</span> = <span class="title class_">React</span>.<span class="property">createContext</span>&lt;<span class="title class_">IColor</span>&gt;(&#123; <span class="attr">color</span>: <span class="string">&quot;green&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>下面是<code>useContext</code>在类型声明文件中的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useContext&lt;T&gt;(<span class="attr">context</span>: <span class="title class_">Context</span>&lt;T&gt;<span class="comment">/*, (not public API) observedBits?: number|boolean */</span>): T;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns a stateful value, and a function to update it.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@version</span> 16.8.0</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> https://reactjs.org/docs/hooks-reference.html#usestate</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>

<h4 id="7-useReducer"><a href="#7-useReducer" class="headerlink" title="7. useReducer"></a>7. useReducer</h4><p>有时我们需要处理一些复杂的状态，并且可能取决于之前的状态。这时候就可以使用<code>useReducer</code>，它接收一个函数，这个函数会根据之前的状态来计算一个新的<code>state</code>。其语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>
<p>来看下面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;increment&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;decrement&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Counter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> initialState = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123;type: &#x27;increment&#x27;&#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123;type: &#x27;decrement&#x27;&#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当前的状态是无法推断出来的，可以给<code>reducer</code>函数添加类型，通过给<code>reducer</code>函数定义<code>state</code>和<code>action</code>来推断 <code>useReducer</code> 的类型，下面来修改上面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">ActionType</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;increment&#x27;</span> | <span class="string">&#x27;decrement&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">type <span class="title class_">State</span> = &#123; <span class="attr">count</span>: number &#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">State</span> = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state: State, action: ActionType</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，在<code>Counter</code>函数中就可以推断出类型。当我们试图使用一个不存在的类型时，就会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;reset&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// Error! type &#x27;&quot;reset&quot;&#x27; is not assignable to type &#x27;&quot;increment&quot; | &quot;decrement&quot;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>除此之外，还可以使用泛型的形式来实现<code>reducer</code>函数的类型定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">ActionType</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;increment&#x27;</span> | <span class="string">&#x27;decrement&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">type <span class="title class_">State</span> = &#123; <span class="attr">count</span>: number &#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">reducer</span>: <span class="title class_">React</span>.<span class="property">Reducer</span>&lt;<span class="title class_">State</span>, <span class="title class_">ActionType</span>&gt; = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实dispatch方法也是有类型的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">State</span> = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="comment">// const dispatch : React.Dispatch&lt;ActionType&gt;</span></span><br><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br></pre></td></tr></table></figure>
<p>可以看到，<code>dispatch</code>的类型是：<code>React.Dispatch</code>，上面示例的完整代码如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ActionType</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;increment&quot;</span> | <span class="string">&quot;decrement&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">State</span> = &#123; <span class="attr">count</span>: <span class="built_in">number</span> &#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Counter</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">reducer</span>: <span class="title class_">React</span>.<span class="property">Reducer</span>&lt;<span class="title class_">State</span>, <span class="title class_">ActionType</span>&gt; = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">State</span> = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;increment&quot; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;decrement&quot; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure>

<h3 id="四、事件处理"><a href="#四、事件处理" class="headerlink" title="四、事件处理"></a>四、事件处理</h3><h4 id="1-Event-事件类型"><a href="#1-Event-事件类型" class="headerlink" title="1. Event 事件类型"></a>1. Event 事件类型</h4><p>在开发中我们会经常在事件处理函数中使用<code>event</code>事件对象，比如在<code>input</code>框输入时实时获取输入的值；使用鼠标事件时，通过 <code>clientX</code>、<code>clientY</code> 获取当前指针的坐标等等。</p>
<p>我们知道，<code>Event</code>是一个对象，并且有很多属性，这时很多人就会把 <code>event</code> 类型定义为<code>any</code>，这样的话<code>TypeScript</code>就失去了它的意义，并不会对<code>event</code>事件进行静态检查，如果一个键盘事件触发了下面的方法，也不会报错：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleEvent</span> = (<span class="params">e: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">clientX</span>, e.<span class="property">clientY</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>Event</code>事件对象中有很多的属性，所以我们也不方便把所有属性及其类型定义在一个<code>interface</code>中，所以<code>React</code>在声明文件中给我们提供了<code>Event</code>事件对象的类型声明。</p>
<p>常见的 <code>Event</code> 事件对象如下：</p>
<ul>
<li>剪切板事件对象：<code>ClipboardEvent&lt;T = Element&gt;</code></li>
<li>拖拽事件对象：<code>DragEvent&lt;T = Element&gt;</code></li>
<li>焦点事件对象：<code>FocusEvent&lt;T = Element&gt;</code></li>
<li>表单事件对象：<code>FormEvent&lt;T = Element&gt;</code></li>
<li>Change事件对象：<code>ChangeEvent&lt;T = Element&gt;</code></li>
<li>键盘事件对象：<code>KeyboardEvent&lt;T = Element&gt;</code></li>
<li>鼠标事件对象：<code>MouseEvent&lt;T = Element, E = NativeMouseEvent&gt;</code></li>
<li>触摸事件对象：<code>TouchEvent&lt;T = Element&gt;</code></li>
<li>滚轮事件对象：<code>WheelEvent&lt;T = Element&gt;</code></li>
<li>动画事件对象：<code>AnimationEvent&lt;T = Element&gt;</code></li>
<li>过渡事件对象：<code>TransitionEvent&lt;T = Element&gt;</code></li>
</ul>
<p>可以看到，这些<code>Event</code>事件对象的泛型中都会接收一个<code>Element</code>元素的类型，这个类型就是我们绑定这个事件的标签元素的类型，标签元素类型将在下面的第五部分介绍。</p>
<p>来看一个简单的例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">State</span> = &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;  </span><br><span class="line">  <span class="keyword">const</span> [text, setText] = useState&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;&quot;</span>)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">const</span> onChange = (<span class="attr">e</span>: <span class="title class_">React</span>.<span class="property">FormEvent</span>&lt;<span class="title class_">HTMLInputElement</span>&gt;): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setText</span>(e.<span class="property">currentTarget</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里就给<code>onChange</code>方法的事件对象定义为了<code>FormEvent</code>类型，并且作用的对象是一个<code>HTMLInputElement</code>类型的标签（<code>input</code>标签）</p>
<p>可以来看下<code>MouseEvent</code>事件对象和<code>ChangeEvent</code>事件对象的类型声明，其他事件对象的声明形似也类似：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MouseEvent</span>&lt;T = <span class="title class_">Element</span>, E = <span class="title class_">NativeMouseEvent</span>&gt; <span class="keyword">extends</span> <span class="title class_">UIEvent</span>&lt;T, E&gt; &#123;</span><br><span class="line">  <span class="attr">altKey</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">button</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">buttons</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">clientX</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">clientY</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">ctrlKey</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * See [DOM Level 3 Events spec](https://www.w3.org/TR/uievents-key/#keys-modifier). for a list of valid (case-sensitive) arguments to this method.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="title function_">getModifierState</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">metaKey</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">movementX</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">movementY</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">pageX</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">pageY</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">relatedTarget</span>: <span class="title class_">EventTarget</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">screenX</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">screenY</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">shiftKey</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChangeEvent</span>&lt;T = <span class="title class_">Element</span>&gt; <span class="keyword">extends</span> <span class="title class_">SyntheticEvent</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">target</span>: <span class="title class_">EventTarget</span> &amp; T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在很多事件对象的声明文件中都可以看到 <code>EventTarget</code> 的身影。这是因为，<code>DOM</code>的事件操作（监听和触发），都定义在 <code>EventTarget</code>接口上。<code>EventTarget</code> 的类型声明如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">EventTarget</span> &#123;</span><br><span class="line">    <span class="title function_">addEventListener</span>(<span class="attr">type</span>: <span class="built_in">string</span>, <span class="attr">listener</span>: <span class="title class_">EventListenerOrEventListenerObject</span> | <span class="literal">null</span>, options?: <span class="built_in">boolean</span> | <span class="title class_">AddEventListenerOptions</span>): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">dispatchEvent</span>(<span class="attr">evt</span>: <span class="title class_">Event</span>): <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="title function_">removeEventListener</span>(<span class="attr">type</span>: <span class="built_in">string</span>, listener?: <span class="title class_">EventListenerOrEventListenerObject</span> | <span class="literal">null</span>, options?: <span class="title class_">EventListenerOptions</span> | <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如在<code>change</code>事件中，会使用的<code>e.target</code>来获取当前的值，它的的类型就是<code>EventTarget</code>。来看下面的例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;input</span><br><span class="line"> onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">onSourceChange</span>(e)&#125;</span><br><span class="line"> placeholder=<span class="string">&quot;最多30个字&quot;</span></span><br><span class="line">/&gt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSourceChange</span> = (<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">value</span>.<span class="property">length</span> &gt; <span class="number">30</span>) &#123;</span><br><span class="line">      message.<span class="title function_">error</span>(<span class="string">&#x27;请长度不能超过30个字，请重新输入&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setSourceInput</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里定义了一个<code>input</code>输入框，当触发<code>onChange</code>事件时，会调用<code>onSourceChange</code>方法，该方法的参数<code>e</code>的类型就是：<code>React.ChangeEvent</code>，而<code>e.target</code>的类型就是<code>EventTarget</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  target: EventTarget &amp; T</span></span><br><span class="line"><span class="comment">  (property) React.ChangeEvent&lt;HTMLInputElement&gt;.target: EventTarget &amp; HTMLInputElement</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>再来看一个例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">questionList.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">     <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">role</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> handleChangeCurrent(item, e)&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">    // 组件内容...</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleChangeCurrent</span> = (<span class="params">item: IData, e: React.MouseEvent&lt;HTMLDivElement&gt;</span>) =&gt; &#123;</span><br><span class="line">    e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">    <span class="title function_">setCurrent</span>(item);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这点代码中，点击某个盒子，就将它设置为当前的盒子，方便执行其他操作。当鼠标点击盒子时，会触发<code>handleChangeCurrent</code>方法，该方法有两个参数，第二个参数是<code>event</code>对象，在方法中执行了<code>e.stopPropagation();</code>是为了阻止冒泡事件，这里的<code>stopPropagation()</code>实际上并不是鼠标事件<code>MouseEvent</code>的属性，它是合成事件上的属性，来看看声明文件中的定义：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MouseEvent</span>&lt;T = <span class="title class_">Element</span>, E = <span class="title class_">NativeMouseEvent</span>&gt; <span class="keyword">extends</span> <span class="title class_">UIEvent</span>&lt;T, E&gt; &#123;</span><br><span class="line">  <span class="comment">//...     </span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UIEvent</span>&lt;T = <span class="title class_">Element</span>, E = <span class="title class_">NativeUIEvent</span>&gt; <span class="keyword">extends</span> <span class="title class_">SyntheticEvent</span>&lt;T, E&gt; &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SyntheticEvent</span>&lt;T = <span class="title class_">Element</span>, E = <span class="title class_">Event</span>&gt; <span class="keyword">extends</span> <span class="title class_">BaseSyntheticEvent</span>&lt;E, <span class="title class_">EventTarget</span> &amp; T, <span class="title class_">EventTarget</span>&gt; &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">BaseSyntheticEvent</span>&lt;E = <span class="built_in">object</span>, C = <span class="built_in">any</span>, T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="attr">nativeEvent</span>: E;</span><br><span class="line">  <span class="attr">currentTarget</span>: C;</span><br><span class="line">  <span class="attr">target</span>: T;</span><br><span class="line">  <span class="attr">bubbles</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">cancelable</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">defaultPrevented</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">eventPhase</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">isTrusted</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="title function_">preventDefault</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">isDefaultPrevented</span>(): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="title function_">stopPropagation</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">isPropagationStopped</span>(): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="title function_">persist</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">timeStamp</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，这里的<code>stopPropagation()</code>是一层层的继承来的，最终来自于<code>BaseSyntheticEvent</code>合成事件类型。原生的事件集合<code>SyntheticEvent</code>就是继承自合成时间类型。<code>SyntheticEvent&lt;T = Element, E = Event&gt;</code>泛型接口接收当前的元素类型和事件类型，如果不介意这两个参数的类型，完全可以这样写：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input </span><br><span class="line">  onChange=&#123;<span class="function">(<span class="params">e: SyntheticEvent&lt;Element, Event&gt;</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//... </span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-事件处理函数类型"><a href="#2-事件处理函数类型" class="headerlink" title="2. 事件处理函数类型"></a>2. 事件处理函数类型</h4><p>说完事件对象类型，再来看看事件处理函数的类型。<code>React</code>也为我们提供了贴心的提供了事件处理函数的类型声明，来看看所有的事件处理函数的类型声明：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">EventHandler</span>&lt;E <span class="keyword">extends</span> <span class="title class_">SyntheticEvent</span>&lt;<span class="built_in">any</span>&gt;&gt; = &#123; <span class="title function_">bivarianceHack</span>(<span class="attr">event</span>: E): <span class="built_in">void</span> &#125;[<span class="string">&quot;bavarianceHack&quot;</span>];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ReactEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">SyntheticEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 剪切板事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ClipboardEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">ClipboardEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 复合事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">CompositionEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">CompositionEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 拖拽事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">DragEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">DragEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 焦点事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FocusEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">FocusEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 表单事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FormEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">FormEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// Change事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ChangeEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">ChangeEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 键盘事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">KeyboardEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">KeyboardEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 鼠标事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">MouseEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">MouseEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 触屏事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TouchEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">TouchEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 指针事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PointerEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">PointerEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 界面事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UIEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">UIEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 滚轮事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">WheelEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">WheelEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 动画事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">AnimationEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">AnimationEvent</span>&lt;T&gt;&gt;;</span><br><span class="line"><span class="comment">// 过渡事件处理函数</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TransitionEventHandler</span>&lt;T = <span class="title class_">Element</span>&gt; = <span class="title class_">EventHandler</span>&lt;<span class="title class_">TransitionEvent</span>&lt;T&gt;&gt;;</span><br></pre></td></tr></table></figure>
<p>这里面的<code>T</code>的类型也都是<code>Element</code>，指的是触发该事件的<code>HTML</code>标签元素的类型，下面第五部分会介绍。</p>
<p><code>EventHandler</code>会接收一个<code>E</code>，它表示事件处理函数中 <code>Event</code> 对象的类型。<code>bivarianceHack</code> 是事件处理函数的类型定义，函数接收一个 <code>Event</code> 对象，并且其类型为接收到的泛型变量 <code>E</code> 的类型, 返回值为 <code>void</code>。</p>
<p>还看上面的那个例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">State</span> = &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;  </span><br><span class="line">  <span class="keyword">const</span> [text, setText] = useState&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;&quot;</span>)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">const</span> <span class="attr">onChange</span>: <span class="title class_">React</span>.<span class="property">ChangeEventHandler</span>&lt;<span class="title class_">HTMLInputElement</span>&gt; = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setText</span>(e.<span class="property">currentTarget</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里给<code>onChange</code>方法定义了方法的类型，它是一个<code>ChangeEventHandler</code>的类型，并且作用的对象是一个<code>HTMLImnputElement</code>类型的标签（<code>input</code>标签）。</p>
<h3 id="五、HTML标签类型"><a href="#五、HTML标签类型" class="headerlink" title="五、HTML标签类型"></a>五、HTML标签类型</h3><h4 id="1-常见标签类型"><a href="#1-常见标签类型" class="headerlink" title="1. 常见标签类型"></a>1. 常见标签类型</h4><p>在项目的依赖文件中可以找到<code>HTML</code>标签相关的类型声明文件：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  @types</span></span><br><span class="line"><span class="comment">    |</span></span><br><span class="line"><span class="comment">    react</span></span><br><span class="line"><span class="comment">      |</span></span><br><span class="line"><span class="comment">      index.d.ts</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IntrinsicElements</span> &#123;</span><br><span class="line">            <span class="comment">// HTML</span></span><br><span class="line">            <span class="attr">a</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">AnchorHTMLAttributes</span>&lt;<span class="title class_">HTMLAnchorElement</span>&gt;, <span class="title class_">HTMLAnchorElement</span>&gt;;</span><br><span class="line">            <span class="attr">abbr</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">address</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">area</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">AreaHTMLAttributes</span>&lt;<span class="title class_">HTMLAreaElement</span>&gt;, <span class="title class_">HTMLAreaElement</span>&gt;;</span><br><span class="line">            <span class="attr">article</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">aside</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">audio</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">AudioHTMLAttributes</span>&lt;<span class="title class_">HTMLAudioElement</span>&gt;, <span class="title class_">HTMLAudioElement</span>&gt;;</span><br><span class="line">            <span class="attr">b</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">base</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">BaseHTMLAttributes</span>&lt;<span class="title class_">HTMLBaseElement</span>&gt;, <span class="title class_">HTMLBaseElement</span>&gt;;</span><br><span class="line">            <span class="attr">bdi</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">bdo</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">big</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">blockquote</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">BlockquoteHTMLAttributes</span>&lt;<span class="title class_">HTMLQuoteElement</span>&gt;, <span class="title class_">HTMLQuoteElement</span>&gt;;</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLBodyElement</span>&gt;, <span class="title class_">HTMLBodyElement</span>&gt;;</span><br><span class="line">            <span class="attr">br</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLBRElement</span>&gt;, <span class="title class_">HTMLBRElement</span>&gt;;</span><br><span class="line">            <span class="attr">button</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">ButtonHTMLAttributes</span>&lt;<span class="title class_">HTMLButtonElement</span>&gt;, <span class="title class_">HTMLButtonElement</span>&gt;;</span><br><span class="line">            <span class="attr">canvas</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">CanvasHTMLAttributes</span>&lt;<span class="title class_">HTMLCanvasElement</span>&gt;, <span class="title class_">HTMLCanvasElement</span>&gt;;</span><br><span class="line">            <span class="attr">caption</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">cite</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            <span class="attr">code</span>: <span class="title class_">React</span>.<span class="property">DetailedHTMLProps</span>&lt;<span class="title class_">React</span>.<span class="property">HTMLAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;, <span class="title class_">HTMLElement</span>&gt;;</span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>所有的<code>HTML</code>标签的类型都被定义在 <code>intrinsicElements</code> 接口中，常见的标签及其类型如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a</span>: <span class="title class_">HTMLAnchorElement</span>;</span><br><span class="line"><span class="attr">body</span>: <span class="title class_">HTMLBodyElement</span>;</span><br><span class="line"><span class="attr">br</span>: <span class="title class_">HTMLBRElement</span>;</span><br><span class="line"><span class="attr">button</span>: <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line"><span class="attr">div</span>: <span class="title class_">HTMLDivElement</span>;</span><br><span class="line"><span class="attr">h1</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line"><span class="attr">h2</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line"><span class="attr">h3</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line"><span class="attr">html</span>: <span class="title class_">HTMLHtmlElement</span>;</span><br><span class="line"><span class="attr">img</span>: <span class="title class_">HTMLImageElement</span>;</span><br><span class="line"><span class="attr">input</span>: <span class="title class_">HTMLInputElement</span>;</span><br><span class="line"><span class="attr">ul</span>: <span class="title class_">HTMLUListElement</span>;</span><br><span class="line"><span class="attr">li</span>: <span class="title class_">HTMLLIElement</span>;</span><br><span class="line"><span class="attr">link</span>: <span class="title class_">HTMLLinkElement</span>;</span><br><span class="line"><span class="attr">p</span>: <span class="title class_">HTMLParagraphElement</span>;</span><br><span class="line"><span class="attr">span</span>: <span class="title class_">HTMLSpanElement</span>;</span><br><span class="line"><span class="attr">style</span>: <span class="title class_">HTMLStyleElement</span>;</span><br><span class="line"><span class="attr">table</span>: <span class="title class_">HTMLTableElement</span>;</span><br><span class="line"><span class="attr">tbody</span>: <span class="title class_">HTMLTableSectionElement</span>;</span><br><span class="line"><span class="attr">video</span>: <span class="title class_">HTMLVideoElement</span>;</span><br><span class="line"><span class="attr">audio</span>: <span class="title class_">HTMLAudioElement</span>;</span><br><span class="line"><span class="attr">meta</span>: <span class="title class_">HTMLMetaElement</span>;</span><br><span class="line"><span class="attr">form</span>: <span class="title class_">HTMLFormElement</span>;</span><br></pre></td></tr></table></figure>
<p>那什么时候会使用到标签类型呢，上面第四部分的<code>Event</code>事件类型和事件处理函数类型中都使用到了标签的类型。上面的很多的类型都需要传入一个<code>ELement</code>类型的泛型参数，这个泛型参数就是对应的标签类型值，可以根据标签来选择对应的标签类型。这些类型都继承自<code>HTMLElement</code>类型，如果使用时对类型类型要求不高，可以直接写<code>HTMLElement</code>。比如下面的例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Button</span></span><br><span class="line"> <span class="keyword">type</span>=<span class="string">&quot;text&quot;</span></span><br><span class="line"> onClick=&#123;<span class="function">(<span class="params">e: React.MouseEvent&lt;HTMLElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">handleOperate</span>();</span><br><span class="line">  e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">&#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"> <span class="attr">src</span>=<span class="string">&#123;cancelChangeIcon&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">    取消修改</span><br><span class="line">&lt;/<span class="title class_">Button</span>&gt;</span><br></pre></td></tr></table></figure>
<p>其实，在直接操作<code>DOM</code>时也会用到标签类型，虽然我们现在通常会使用框架来开发，但是有时候也避免不了直接操作<code>DOM</code>。比如我在工作中，项目中的某一部分组件是通过<code>npm</code>来引入的其他组的组件，而在很多时候，我有需要动态的去个性化这个组件的样式，最直接的办法就是通过原生<code>JavaScript</code>获取到<code>DOM</code>元素，来进行样式的修改，这时候就会用到标签类型。</p>
<p>来看下面的例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.paper&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> firstPageHasAddEle = (item.<span class="property">firstChild</span> <span class="keyword">as</span> <span class="title class_">HTMLDivElement</span>).<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;add-ele&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (firstPageHasAddEle) &#123;</span><br><span class="line">    item.<span class="title function_">removeChild</span>(item.<span class="property">firstChild</span> <span class="keyword">as</span> <span class="title class_">ChildNode</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在第一页有个<code>add-ele</code>元素的时候就删除它。这里我们将<code>item.firstChild</code>断言成了<code>HTMLDivElement</code>类型，如果不断言，<code>item.firstChild</code>的类型就是<code>ChildNode</code>，而<code>ChildNode</code>类型中是不存在<code>classList</code>属性的，所以就就会报错，当我们把他断言成<code>HTMLDivElement</code>类型时，就不会报错了。很多时候，标签类型可以和断言（<code>as</code>）一起使用。</p>
<p>后面在<code>removeChild</code>时又使用了<code>as</code>断言，为什么呢？<code>item.firstChild</code>不是已经自动识别为<code>ChildNode</code>类型了吗？因为<code>TS</code>会认为，我们可能不能获取到类名为<code>paper</code>的元素，所以<code>item.firstChild</code>的类型就被推断为<code>ChildNode | null</code>，我们有时候比TS更懂我们定义的元素，知道页面一定存在<code>paper</code> 元素，所以可以直接将<code>item.firstChild</code>断言成<code>ChildNode</code>类型。</p>
<h4 id="2-标签属性类型"><a href="#2-标签属性类型" class="headerlink" title="2. 标签属性类型"></a>2. 标签属性类型</h4><p>众所周知，每个<code>HTML</code>标签都有自己的属性，比如<code>Input</code>框就有<code>value</code>、<code>width</code>、<code>placeholder</code>、<code>max-length</code>等属性，下面是<code>Input</code>框的属性类型定义：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">InputHTMLAttributes</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">HTMLAttributes</span>&lt;T&gt; &#123;</span><br><span class="line">  accept?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  alt?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  autoComplete?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  autoFocus?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  capture?: <span class="built_in">boolean</span> | <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  checked?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  crossOrigin?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  disabled?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  enterKeyHint?: <span class="string">&#x27;enter&#x27;</span> | <span class="string">&#x27;done&#x27;</span> | <span class="string">&#x27;go&#x27;</span> | <span class="string">&#x27;next&#x27;</span> | <span class="string">&#x27;previous&#x27;</span> | <span class="string">&#x27;search&#x27;</span> | <span class="string">&#x27;send&#x27;</span> | <span class="literal">undefined</span>;</span><br><span class="line">  form?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  formAction?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  formEncType?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  formMethod?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  formNoValidate?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  formTarget?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  height?: <span class="built_in">number</span> | <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  list?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  max?: <span class="built_in">number</span> | <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  maxLength?: <span class="built_in">number</span> | <span class="literal">undefined</span>;</span><br><span class="line">  min?: <span class="built_in">number</span> | <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  minLength?: <span class="built_in">number</span> | <span class="literal">undefined</span>;</span><br><span class="line">  multiple?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  name?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  pattern?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  placeholder?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  readOnly?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  required?: <span class="built_in">boolean</span> | <span class="literal">undefined</span>;</span><br><span class="line">  size?: <span class="built_in">number</span> | <span class="literal">undefined</span>;</span><br><span class="line">  src?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  step?: <span class="built_in">number</span> | <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">type</span>?: <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">  value?: <span class="built_in">string</span> | <span class="title class_">ReadonlyArray</span>&lt;<span class="built_in">string</span>&gt; | <span class="built_in">number</span> | <span class="literal">undefined</span>;</span><br><span class="line">  width?: <span class="built_in">number</span> | <span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line"> </span><br><span class="line">  onChange?: <span class="title class_">ChangeEventHandler</span>&lt;T&gt; | <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们需要直接操作<code>DOM</code>，就可能会用到元素属性类型，常见的元素属性类型如下：</p>
<ul>
<li><code>HTML</code>属性类型：<code>HTMLAttributes</code></li>
<li>按钮属性类型：<code>ButtonHTMLAttributes</code></li>
<li>表单属性类型：<code>FormHTMLAttributes</code></li>
<li>图片属性类型：<code>ImgHTMLAttributes</code></li>
<li>输入框属性类型：<code>InputHTMLAttributes</code></li>
<li>链接属性类型：<code>LinkHTMLAttributes</code></li>
<li><code>meta</code>属性类型：<code>MetaHTMLAttributes</code></li>
<li>选择框属性类型：<code>SelectHTMLAttributes</code></li>
<li>表格属性类型：<code>TableHTMLAttributes</code></li>
<li>输入区属性类型：<code>TextareaHTMLAttributes</code></li>
<li>视频属性类型：<code>VideoHTMLAttributes</code></li>
<li><code>SVG</code>属性类型：<code>SVGAttributes</code></li>
<li><code>WebView</code>属性类型：<code>WebViewHTMLAttributes</code></li>
</ul>
<p>一般情况下，我们是很少需要在项目中显式的去定义标签属性的类型。如果子级去封装组件库的话，这些属性就能发挥它们的作用了。来看例子（来源于网络，仅供学习）：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">ButtonSize</span> &#123;</span><br><span class="line">    <span class="title class_">Large</span> = <span class="string">&#x27;lg&#x27;</span>,</span><br><span class="line">    <span class="title class_">Small</span> = <span class="string">&#x27;sm&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">ButtonType</span> &#123;</span><br><span class="line">    <span class="title class_">Primary</span> = <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line">    <span class="title class_">Default</span> = <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">    <span class="title class_">Danger</span> = <span class="string">&#x27;danger&#x27;</span>,</span><br><span class="line">    <span class="title class_">Link</span> = <span class="string">&#x27;link&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">BaseButtonProps</span> &#123;</span><br><span class="line">    className?: <span class="built_in">string</span>;</span><br><span class="line">    disabled?: <span class="built_in">boolean</span>;</span><br><span class="line">    size?: <span class="title class_">ButtonSize</span>;</span><br><span class="line">    btnType?: <span class="title class_">ButtonType</span>;</span><br><span class="line">    <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">    href?: <span class="built_in">string</span>;    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NativeButtonProps</span> = <span class="title class_">BaseButtonProps</span> &amp; <span class="title class_">React</span>.<span class="property">ButtonHTMLAttributes</span>&lt;<span class="title class_">HTMLButtonElement</span>&gt; <span class="comment">// 使用 交叉类型（&amp;） 获得我们自己定义的属性和原生 button 的属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">AnchorButtonProps</span> = <span class="title class_">BaseButtonProps</span> &amp; <span class="title class_">React</span>.<span class="property">AnchorHTMLAttributes</span>&lt;<span class="title class_">HTMLAnchorElement</span>&gt; <span class="comment">// 使用 交叉类型（&amp;） 获得我们自己定义的属性和原生 a标签 的属性</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonProps</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">NativeButtonProps</span> &amp; <span class="title class_">AnchorButtonProps</span>&gt; <span class="comment">//使用 Partial&lt;&gt; 使两种属性可选</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">ButtonProps</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; </span><br><span class="line">        disabled,</span><br><span class="line">        className, </span><br><span class="line">        size,</span><br><span class="line">        btnType,</span><br><span class="line">        children,</span><br><span class="line">        href,</span><br><span class="line">        ...restProps  </span><br><span class="line">    &#125; = props;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> classes = <span class="title function_">classNames</span>(<span class="string">&#x27;btn&#x27;</span>, className, &#123;</span><br><span class="line">        [<span class="string">`btn-<span class="subst">$&#123;btnType&#125;</span>`</span>]: btnType,</span><br><span class="line">        [<span class="string">`btn-<span class="subst">$&#123;size&#125;</span>`</span>]: size,</span><br><span class="line">        <span class="string">&#x27;disabled&#x27;</span>: (btnType === <span class="title class_">ButtonType</span>.<span class="property">Link</span>) &amp;&amp; disabled  <span class="comment">// 只有 a 标签才有 disabled 类名，button没有</span></span><br><span class="line">    &#125;)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(btnType === <span class="title class_">ButtonType</span>.<span class="property">Link</span> &amp;&amp; href) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">             <span class="attr">className</span>=<span class="string">&#123;classes&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">             <span class="attr">href</span>=<span class="string">&#123;href&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">             &#123;<span class="attr">...restProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line"> </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">             <span class="attr">className</span>=<span class="string">&#123;classes&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">             <span class="attr">disabled</span>=<span class="string">&#123;disabled&#125;</span> // <span class="attr">button元素默认有disabled属性</span>，<span class="attr">所以即便没给他设置样式也会和普通button有一定区别</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">             &#123;<span class="attr">...restProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">Button</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">    <span class="attr">disabled</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">btnType</span>: <span class="title class_">ButtonType</span>.<span class="property">Default</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Button</span>;</span><br></pre></td></tr></table></figure>
<p>这段代码就是用来封装一个<code>button</code>按钮，在<code>button</code>的基础上添加了一些自定义属性，比如上面将<code>button</code>的类型使用交叉类型（<code>&amp;</code>）获得自定义属性和原生 <code>button</code> 属性：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">NativeButtonProps</span> = <span class="title class_">BaseButtonProps</span> &amp; <span class="title class_">React</span>.<span class="property">ButtonHTMLAttributes</span>&lt;<span class="title class_">HTMLButtonElement</span>&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到，标签属性类型在封装组件库时还是很有用的，更多用途可以自己探索~</p>
<h3 id="六、工具泛型"><a href="#六、工具泛型" class="headerlink" title="六、工具泛型"></a>六、工具泛型</h3><p>在项目中使用一些工具泛型可以提高我们的开发效率，少写很多类型定义。下面来看看有哪些常见的工具泛型，以及其使用方式。</p>
<h4 id="1-Partial"><a href="#1-Partial" class="headerlink" title="1. Partial"></a>1. Partial</h4><p><code>Partial</code> 作用是<strong>将传入的属性变为可选项</strong>。适用于对类型结构不明确的情况。它使用了两个关键字：<code>keyof</code>和<code>in</code>，先来看看他们都是什么含义。<code>keyof</code> 可以用来取得接口的所有 <code>key</code> 值：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> T = keyof <span class="title class_">IPerson</span> </span><br><span class="line"><span class="comment">// T 类型为： &quot;name&quot; | &quot;age&quot; | &quot;number&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>in</code>关键字可以遍历枚举类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = <span class="string">&quot;name&quot;</span> | <span class="string">&quot;age&quot;</span> | <span class="string">&quot;number&quot;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Obj</span> =  &#123;</span><br><span class="line">  [p <span class="keyword">in</span> <span class="title class_">Keys</span>]: <span class="built_in">any</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// Obj类型为： &#123; name: any, age: any, number: any &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>keyof</code> 可以产生联合类型, <code>in</code> 可以遍历枚举类型, 所以经常一起使用, 下面是<code>Partial</code>工具泛型的定义：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Make all properties in T optional</span></span><br><span class="line"><span class="comment"> * 将T中的所有属性设置为可选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里，<code>keyof T</code> 获取 <code>T</code> 所有属性名, 然后使用 <code>in</code> 进行遍历, 将值赋给 <code>P</code>, 最后 <code>T[P]</code> 取得相应属性的值。中间的 <code>?</code> 就用来将属性设置为可选。</p>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">Partial</span>&lt;<span class="title class_">IPerson</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ZhangSan&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Required"><a href="#2-Required" class="headerlink" title="2. Required"></a>2. Required</h4><p><code>Required</code> 的作用是将传入的属性变为必选项，和上面的工具泛型恰好相反，其声明如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Make all properties in T required</span></span><br><span class="line"><span class="comment"> * 将T中的所有属性设置为必选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Required</span>&lt;T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> keyof T]-?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以看到，这里使用<code>-?</code>将属性设置为必选，可以理解为减去问号。使用形式和上面的<code>Partial</code>差不多：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  name?: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">  height?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">Required</span>&lt;<span class="title class_">IPerson</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ZhangSan&quot;</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="number">180</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-Readonly"><a href="#3-Readonly" class="headerlink" title="3. Readonly"></a>3. Readonly</h4><p>将<code>T</code>类型的所有属性设置为只读（<code>readonly</code>），构造出来类型的属性不能被再次赋值。<code>Readonly</code>的声明形式如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Make all properties in T readonly</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line">    <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">Readonly</span>&lt;<span class="title class_">IPerson</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ZhangSan&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">person.<span class="property">age</span> = <span class="number">20</span>;  <span class="comment">//  Error: cannot reassign a readonly property</span></span><br></pre></td></tr></table></figure>
<p>可以看到，通过 <code>Readonly</code> 将 <code>IPerson</code> 的属性转化成了只读，不能再进行赋值操作。</p>
<h4 id="4-Pick-lt-T-K-extends-keyof-T-gt"><a href="#4-Pick-lt-T-K-extends-keyof-T-gt" class="headerlink" title="4. Pick&lt;T, K extends keyof T&gt;"></a>4. Pick&lt;T, K extends keyof T&gt;</h4><p>从 <code>T</code> 类型中挑选部分属性 <code>K</code> 来构造新的类型。它的声明形式如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * From T, pick a set of properties whose keys are in the union K</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">Pick</span>&lt;<span class="title class_">IPerson</span>, <span class="string">&quot;name&quot;</span> | <span class="string">&quot;age&quot;</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ZhangSan&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-Record-lt-K-extends-keyof-any-T-gt"><a href="#5-Record-lt-K-extends-keyof-any-T-gt" class="headerlink" title="5. Record&lt;K extends keyof any, T&gt;"></a>5. Record&lt;K extends keyof any, T&gt;</h4><p><code>Record</code> 用来构造一个类型，其属性名的类型为 <code>K</code>，属性值的类型为 <code>T</code>。这个工具泛型可用来将某个类型的属性映射到另一个类型上，下面是其声明形式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Construct a type with a set of properties K of type T</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPageInfo</span> &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">IPage</span> = <span class="string">&#x27;home&#x27;</span> | <span class="string">&#x27;about&#x27;</span> | <span class="string">&#x27;contact&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">page</span>: <span class="title class_">Record</span>&lt;<span class="title class_">IPage</span>, <span class="title class_">IPageInfo</span>&gt; = &#123;</span><br><span class="line">    <span class="attr">about</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;about&#x27;</span>&#125;,</span><br><span class="line">    <span class="attr">contact</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;contact&#x27;</span>&#125;,</span><br><span class="line">    <span class="attr">home</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;home&#x27;</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-Exclude-lt-T-U-gt"><a href="#6-Exclude-lt-T-U-gt" class="headerlink" title="6. Exclude&lt;T, U&gt;"></a>6. Exclude&lt;T, U&gt;</h4><p><code>Exclude</code> 就是从一个联合类型中排除掉属于另一个联合类型的子集，下面是其声明的形式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Exclude from T those types that are assignable to U</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Exclude</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br></pre></td></tr></table></figure>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">Exclude</span>&lt;<span class="title class_">IPerson</span>, <span class="string">&quot;age&quot;</span> | <span class="string">&quot;sex&quot;</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ZhangSan&quot;</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="number">180</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-Omit-lt-T-K-extends-keyof-any-gt"><a href="#7-Omit-lt-T-K-extends-keyof-any-gt" class="headerlink" title="7. Omit&lt;T, K extends keyof any&gt;"></a>7. Omit&lt;T, K extends keyof any&gt;</h4><p>上面的 <code>Pick</code> 和 <code>Exclude</code> 都是最基础基础的工具泛型，很多时候用 <code>Pick</code> 或者 <code>Exclude</code> 还不如直接写类型更直接。而 <code>Omit</code> 就基于这两个来做的一个更抽象的封装，它允许从一个对象中剔除若干个属性，剩下的就是需要的新类型。下面是它的声明形式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Construct a type with the properties of T except for those in type K.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Omit</span>&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">Omit</span>&lt;<span class="title class_">IPerson</span>, <span class="string">&quot;age&quot;</span> | <span class="string">&quot;height&quot;</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ZhangSan&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-ReturnType"><a href="#8-ReturnType" class="headerlink" title="8. ReturnType"></a>8. ReturnType</h4><p><code>ReturnType</code>会返回函数返回值的类型，其声明形式如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Obtain the return type of a function type</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ReturnType</span>&lt;T <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; infer R ? R : <span class="built_in">any</span>;</span><br></pre></td></tr></table></figure>
<p>使用示例如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"><span class="keyword">type</span></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">type</span> === <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FooType</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> foo&gt;</span><br></pre></td></tr></table></figure>
<p>这里使用 <code>typeof</code> 是为了获取 <code>foo</code> 的函数签名，等价于 (<code>type: any) =&gt; boolean</code>。</p>
<h3 id="七、Axios-封装"><a href="#七、Axios-封装" class="headerlink" title="七、Axios 封装"></a>七、Axios 封装</h3><p>在<code>React</code>项目中，我们经常使用<code>Axios</code>库进行数据请求，<code>Axios</code> 是基于 <code>Promise</code> 的 <code>HTTP</code> 库，可以在浏览器和 <code>node.js</code> 中使用。<code>Axios</code> 具备以下特性：</p>
<ul>
<li>从浏览器中创建 <code>XMLHttpRequests</code>；</li>
<li>从 <code>node.js</code> 创建 <code>HTTP</code> 请求；</li>
<li>支持 <code>Promise API</code>；</li>
<li>拦截请求和响应；</li>
<li>转换请求数据和响应数据；</li>
<li>取消请求；</li>
<li>自动转换 <code>JSON</code> 数据；</li>
<li>客户端支持防御 <code>XSRF</code>。</li>
</ul>
<p><code>Axios</code>的基本使用就不再多介绍了。为了更好地调用，做一些全局的拦截，通常会对<code>Axios</code>进行封装，下面就使用<code>TypeScript</code>对<code>Axios</code>进行简单封装，使其同时能够有很好的类型支持。<code>Axios</code>是自带声明文件的，所以我们无需额外的操作。</p>
<p>下面来看基本的封装：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>,<span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>; <span class="comment">// 引入axios和定义在node_modules/axios/index.ts文件里的类型声明</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 定义接口请求类，用于创建axios请求实例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpRequest</span> &#123;</span><br><span class="line">  <span class="comment">// 接收接口请求的基本路径</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> baseUrl: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseUrl</span> = baseUrl;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调用接口时调用实例的这个方法，返回AxiosPromise</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">request</span>(<span class="attr">options</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123; </span><br><span class="line">    <span class="comment">// 创建axios实例，它是函数，同时这个函数包含多个属性</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>() </span><br><span class="line">    <span class="comment">// 合并基础路径和每个接口单独传入的配置，比如url、参数等</span></span><br><span class="line">    options = <span class="variable language_">this</span>.<span class="title function_">mergeConfig</span>(options) </span><br><span class="line">    <span class="comment">// 调用interceptors方法使拦截器生效</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">interceptors</span>(instance, options.<span class="property">url</span>) </span><br><span class="line">    <span class="comment">// 返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">instance</span>(options) </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 用于添加全局请求和响应拦截</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">interceptors</span>(<span class="params">instance: AxiosInstance, url?: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">    <span class="comment">// 请求和响应拦截</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 用于合并基础路径配置和接口单独配置</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">mergeConfig</span>(<span class="attr">options</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosRequestConfig</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123; <span class="attr">baseURL</span>: <span class="variable language_">this</span>.<span class="property">baseUrl</span> &#125;, options);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">HttpRequest</span>;</span><br></pre></td></tr></table></figure>
<p>通常<code>baseUrl</code>在开发环境的和生产环境的路径是不一样的，所以可以根据当前是开发环境还是生产环境做判断，应用不同的基础路径。这里要写在一个配置文件里：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">api</span>: &#123;</span><br><span class="line">        <span class="attr">devApiBaseUrl</span>: <span class="string">&#x27;/test/api/xxx&#x27;</span>,</span><br><span class="line">        <span class="attr">proApiBaseUrl</span>: <span class="string">&#x27;/api/xxx&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在上面的文件中引入这个配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="attr">api</span>: &#123; devApiBaseUrl, proApiBaseUrl &#125; &#125; <span class="keyword">from</span> <span class="string">&#x27;@/config&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> apiBaseUrl = env.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? proApiBaseUrl : devApiBaseUrl;</span><br></pre></td></tr></table></figure>
<p>之后就可以将<code>apiBaseUrl</code>作为默认值传入<code>HttpRequest</code>的参数：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HttpRequest</span> &#123; </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> baseUrl: <span class="built_in">string</span> = apiBaseUrl</span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseUrl</span> = baseUrl;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>接下来可以完善一下拦截器类，在类中<code>interceptors</code>方法内添加请求拦截器和响应拦截器，实现对所有接口请求的统一处理：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">interceptors</span>(<span class="params">instance: AxiosInstance, url?: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">   <span class="comment">// 请求拦截</span></span><br><span class="line">    instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config: AxiosRequestConfig</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 接口请求的所有配置，可以在axios.defaults修改配置</span></span><br><span class="line">      <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;)</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// 响应拦截</span></span><br><span class="line">    instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">res: AxiosResponse</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = res </span><br><span class="line">      <span class="keyword">const</span> &#123; code, msg &#125; = data</span><br><span class="line">      <span class="keyword">if</span> (code !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(msg) </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error</span>) =&gt;</span> &#123; </span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>到这里封装的就差不多了，一般服务端会将状态码、提示信息和数据封装在一起，然后作为数据返回，所以所有请求返回的数据格式都是一样的，所以就可以定义一个接口来指定返回的数据结构，可以定义一个接口：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ResponseData</span> &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span></span><br><span class="line">  data?: <span class="built_in">any</span></span><br><span class="line">  <span class="attr">msg</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来看看使用<code>TypeScript</code>封装的<code>Axios</code>该如何使用。可以先定义一个请求实例：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">HttpRequest</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/axios&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@/utils/axios&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">HttpRequest</span>()</span><br></pre></td></tr></table></figure>
<p>这里把请求类导入进来，默认导出这个类的实例。之后创建一个登陆接口请求方法：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">ResponseData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ILogin</span> &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">password</span>: <span class="built_in">number</span> | <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loginReq = (<span class="attr">data</span>: <span class="title class_">ILogin</span>): <span class="title class_">AxiosPromise</span>&lt;<span class="title class_">ResponseData</span>&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/api/user/login&#x27;</span>,</span><br><span class="line">    data,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里封装登录请求方法<code>loginReq</code>，他的参数必须是我们定义的<code>ILogin</code>接口的类型。这个方法返回一个类型为<code>AxiosPromise</code>的<code>Promise</code>，<code>AxiosPromise</code>是<code>axios</code>声明文件内置的类型，可以传入一个泛型变量参数，用于指定返回的结果中<code>data</code>字段的类型。</p>
<p>接下来可以调用一下这个登录的接口：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; loginReq &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">login</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line">   <span class="title function_">loginReq</span>(params).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>.<span class="property">code</span>)</span><br><span class="line">   &#125;) </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过这种方式，当我们调用<code>loginReq</code>接口时，就会提示我们，参数的类型是<code>ILogin</code>，需要传入几个参数。这样编写代码的体验就会好很多。</p>
<h3 id="八-其他"><a href="#八-其他" class="headerlink" title="八. 其他"></a>八. 其他</h3><h4 id="1-import-React"><a href="#1-import-React" class="headerlink" title="1. import React"></a>1. import React</h4><p>在<code>React</code>项目中使用<code>TypeScript</code>时，普通组件文件后缀为<code>.tsx</code>，公共方法文件后缀为<code>.ts</code>。在 <code>.tsx</code> 文件中导入 <code>React</code> 的方式如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这是一种面向未来的导入方式，如果想在项目中使用以下导入方式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>就需要在<code>tsconfig.json</code>配置文件中进行如下配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 允许默认从没有默认导出的模块导入。</span></span><br><span class="line">    <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Types-or-Interfaces？"><a href="#2-Types-or-Interfaces？" class="headerlink" title="2. Types or Interfaces？"></a>2. Types or Interfaces？</h4><p>我们可以使用<code>types</code>或者<code>Interfaces</code>来定义类型吗，那么该如何选择他俩呢？建议如下：</p>
<p>在定义公共 <code>API</code> 时(比如编辑一个库）使用 <code>interface</code>，这样可以方便使用者继承接口，这样允许使用者通过声明合并来扩展它们；</p>
<p>在定义组件属性（<code>Props</code>）和状态（<code>State</code>）时，建议使用 <code>type</code>，因为 <code>type</code> 的约束性更强。</p>
<p><code>interface</code> 和 <code>type</code> 在 <code>ts</code> 中是两个不同的概念，但在 <code>React</code> 大部分使用的 <code>case</code> 中，<code>interface</code> 和 <code>type</code> 可以达到相同的功能效果，<code>type</code> 和 <code>interface</code> 最大的区别是：<code>type</code> 类型不能二次编辑，而 <code>interface</code> 可以随时扩展：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 可以继续在原属性基础上，添加新属性：color</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Animal</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// type类型不支持属性扩展</span></span><br><span class="line"><span class="comment">// Error: Duplicate identifier &#x27;Animal&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Animal</span> = &#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>type</code>对于联合类型是很有用的，比如：<code>type Type = TypeA | TypeB</code>。而<code>interface</code>更适合声明字典类行，然后定义或者扩展它。</p>
<h4 id="3-懒加载类型"><a href="#3-懒加载类型" class="headerlink" title="3. 懒加载类型"></a>3. 懒加载类型</h4><p>如果我们想在<code>React router</code>中使用懒加载，<code>React</code>也为我们提供了懒加载方法的类型，来看下面的例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RouteType</span> &#123;</span><br><span class="line">    <span class="attr">pathname</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">LazyExoticComponent</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">    <span class="attr">exact</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    title?: <span class="built_in">string</span>;</span><br><span class="line">    icon?: <span class="built_in">string</span>;</span><br><span class="line">    children?: <span class="title class_">RouteType</span>[];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">AppRoutes</span>: <span class="title class_">RouteType</span>[] = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">pathname</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Login/Login&#x27;</span>)),</span><br><span class="line">        <span class="attr">exact</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">pathname</span>: <span class="string">&#x27;/404&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/404/404&#x27;</span>)),</span><br><span class="line">        <span class="attr">exact</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">pathname</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">exact</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Admin/Admin&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>下面是懒加载类型和<code>lazy</code>方法在声明文件中的定义：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">LazyExoticComponent</span>&lt;T <span class="keyword">extends</span> <span class="title class_">ComponentType</span>&lt;<span class="built_in">any</span>&gt;&gt; = <span class="title class_">ExoticComponent</span>&lt;<span class="title class_">ComponentPropsWithRef</span>&lt;T&gt;&gt; &amp; &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">_result</span>: T;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> lazy&lt;T <span class="keyword">extends</span> <span class="title class_">ComponentType</span>&lt;<span class="built_in">any</span>&gt;&gt;(</span><br><span class="line"><span class="attr">factory</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;&#123; <span class="attr">default</span>: T &#125;&gt;</span><br><span class="line">): <span class="title class_">LazyExoticComponent</span>&lt;T&gt;;</span><br></pre></td></tr></table></figure>

<h4 id="4-类型断言"><a href="#4-类型断言" class="headerlink" title="4. 类型断言"></a>4. 类型断言</h4><p>类型断言（<code>Type Assertion</code>）可以用来手动指定一个值的类型。在<code>React</code>项目中，断言还是很有用的，。有时候推断出来的类型并不是真正的类型，很多时候我们可能会比<code>TS</code>更懂我们的代码，所以可以使用断言（使用<code>as</code>关键字）来定义一个值得类型。</p>
<p>来看下面的例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getLength = (<span class="attr">target</span>: <span class="built_in">string</span> | <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (target.<span class="property">length</span>) &#123; <span class="comment">// error 类型&quot;string | number&quot;上不存在属性&quot;length&quot;</span></span><br><span class="line">    <span class="keyword">return</span> target.<span class="property">length</span>; <span class="comment">// error  类型&quot;number&quot;上不存在属性&quot;length&quot;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target.<span class="title function_">toString</span>().<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>当<code>TypeScript</code>不确定一个联合类型的变量到底是哪个类型时，就只能访问此联合类型的所有类型里共有的属性或方法，所以现在加了对参数<code>target</code>和返回值的类型定义之后就会报错。这时就可以使用断言，将<code>target</code>的类型断言成<code>string</code>类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getStrLength = (<span class="attr">target</span>: <span class="built_in">string</span> | <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ((target <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>) &#123;      </span><br><span class="line">    <span class="keyword">return</span> (target <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>; </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target.<span class="title function_">toString</span>().<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>需要注意，类型断言并不是类型转换，断言成一个联合类型中不存在的类型是不允许的。上面所说的标签类型、组件类型、时间类型都可以使用断言来指定给一些数据，还是要根据实际的业务场景来使用。</p>
<p>感悟：使用类型断言真的能解决项目中的很多报错~</p>
<h4 id="5-枚举类型"><a href="#5-枚举类型" class="headerlink" title="5. 枚举类型"></a>5. 枚举类型</h4><p>枚举类型在项目中的作用也是不可忽视的，使用枚举类型可以让代码的扩展性更好，当我想更改某属性值时，无需去全局更改这个属性，只要更改枚举中的值即可。通常情况下，最好新建一个文件专门来定义枚举值，便于引用。</p>
<p>关于在<code>React</code>项目中如何优雅的使用<code>TypeScript</code>就先介绍这么多，后面有新的内容会再分享给大家。如果觉得不错就点个赞吧！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/24/React-TypeScript-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/24/React-TypeScript-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">React + TypeScript 最佳实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-24 17:05:54" itemprop="dateCreated datePublished" datetime="2022-08-24T17:05:54+08:00">2022-08-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-27 10:30:01" itemprop="dateModified" datetime="2023-09-27T10:30:01+08:00">2023-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/FE/" itemprop="url" rel="index"><span itemprop="name">FE</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文译[<a target="_blank" rel="noopener" href="https://www.sitepoint.com/react-with-typescript-best-practices/]">https://www.sitepoint.com/react-with-typescript-best-practices/]</a></p>
</blockquote>
<p>如今， <code>React</code> 和 <code>TypeScript</code> 是许多开发人员正在使用的两种很棒的技术。但是把他们结合起来使用就变得很棘手了，有时很难找到正确的答案。不要担心，本文我们来总结一下两者结合使用的最佳实践。</p>
<h3 id="React-和-TypeScript-如何一起使用"><a href="#React-和-TypeScript-如何一起使用" class="headerlink" title="React 和 TypeScript 如何一起使用"></a><code>React</code> 和 <code>TypeScript</code> 如何一起使用</h3><p>在开始之前，让我们回顾一下 <code>React</code> 和 <code>TypeScript</code> 是如何一起工作的。<code>React</code> 是一个 “用于构建用户界面的 <code>JavaScript</code> 库”，而 <code>TypeScript</code> 是一个 “可编译为普通 <code>JavaScript</code> 的 <code>JavaScript</code> 类型化超集” 。通过同时使用它们，我们实际上是使用 <code>JavaScript</code> 的类型化版本来构建 <code>UI</code>。</p>
<p>将它们一起使用的原因是为了获得静态类型化语言( <code>TypeScript</code> )对 <code>UI</code> 的好处：减少 <code>JS</code> 带来的 <code>bug</code>，让前端开发更安全。</p>
<h4 id="TypeScript-会编译我的-React-代码吗？"><a href="#TypeScript-会编译我的-React-代码吗？" class="headerlink" title="TypeScript 会编译我的 React 代码吗？"></a><code>TypeScript</code> 会编译我的 <code>React</code> 代码吗？</h4><p>一个经常被提到的常见问题是 <code>TypeScript</code> 是否编译你的 <code>React</code> 代码。<code>TypeScript</code> 的工作原理类似于下面的方式：</p>
<blockquote>
<p><code>TS</code>：“嘿，这是你所有的 <code>UI</code> 代码吗？”<br><code>React</code>：“是的！”<br><code>TS</code>：“酷！我将对其进行编译，并确保你没有错过任何内容。”<br><code>React</code>：“听起来对我很好！”</p>
</blockquote>
<p>因此，答案是肯定的！但是稍后，当我们介绍 <code>tsconfig.json</code> 配置时，大多数时候你都想使用 <code>&quot;noEmit&quot;: true</code> 。这是因为通常情况下，我们只是利用 <code>TypeScript</code> 进行类型检查。</p>
<p>概括地说， <code>TypeScript</code> 编译你的 <code>React</code> 代码以对你的代码进行类型检查。在大多数情况下，它不会发出任何 <code>JavaScript</code> 输出。输出仍然类似于非 <code>TypeScript React</code> 项目。</p>
<h4 id="TypeScript-可以与-React-和-Webpack-一起使用吗？"><a href="#TypeScript-可以与-React-和-Webpack-一起使用吗？" class="headerlink" title="TypeScript 可以与 React 和 Webpack 一起使用吗？"></a><code>TypeScript</code> 可以与 <code>React</code> 和 <code>Webpack</code> 一起使用吗？</h4><p>是的， <code>TypeScript</code> 可以与 <code>React</code> 和 <code>webpack</code> 一起使用。幸运的是，官方 <code>TypeScript</code> 手册对此提供了配置指南。</p>
<p>希望这能使你轻而易举地了解两者的工作方式。现在，进入最佳实践！</p>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><p>我们研究了最常见的问题，并整理了 <code>React with TypeScript</code> 最常用的一些写法和配置。这样，通过使用本文作为参考，你可以在项目中遵循最佳实践。</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>配置是开发中最无趣但是最重要的部分之一。我们怎样才能在最短的时间内完成这些配置，从而提供最大的效率和生产力？我们一起来讨论下面的配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tsconfig.json</span><br><span class="line">ESLint / Prettier</span><br><span class="line">VS Code 扩展和配置</span><br></pre></td></tr></table></figure>

<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p>初始化一个 <code>React/TypeScript</code> 应用程序的最快方法是 <code>create-react-app</code> 与 <code>TypeScript</code> 模板一起使用。你可以运行以下面的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn create react-app may-app --template typescript</span><br></pre></td></tr></table></figure>
<p>这可以让你开始使用 <code>TypeScript</code> 编写 <code>React</code> 。一些明显的区别是：<br><code>.tsx</code>：<code>TypeScript JSX</code> 文件扩展<br><code>tsconfig.json</code>：具有一些默认配置的 <code>TypeScript</code> 配置文件<br><code>react-app-env.d.ts</code>：<code>TypeScript</code> 声明文件，可以进行允许引用 <code>SVG</code> 这样的配置</p>
<h4 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h4><p>幸运的是，最新的 <code>React/TypeScript</code> 会自动生成 <code>tsconfig.json</code> ，并且默认带有一些最基本的配置。我们建议你修改成下面的内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es5&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定 ECMAScript 版本</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;dom&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dom.iterable&quot;</span><span class="punctuation">,</span> <span class="string">&quot;esnext&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 要包含在编译中的依赖库文件列表</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 允许编译 JavaScript 文件</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 跳过所有声明文件的类型检查</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 禁用命名空间引用 (import * as fs from &quot;fs&quot;) 启用 CJS/AMD/UMD 风格引用 (import fs from &quot;fs&quot;)</span></span><br><span class="line">    <span class="attr">&quot;allowSyntheticDefaultImports&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 允许从没有默认导出的模块进行默认导入</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用所有严格类型检查选项</span></span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 不允许对同一个文件使用不一致格式的引用</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定模块代码生成</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span> <span class="comment">// 使用 Node.js 风格解析模块</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 允许使用 .json 扩展名导入的模块</span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 不输出(意思是不编译代码，只执行类型检查)</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-jsx&quot;</span><span class="punctuation">,</span> <span class="comment">// 在.tsx文件中支持JSX</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 生成相应的.map文件</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 生成相应的.d.ts文件</span></span><br><span class="line">    <span class="attr">&quot;noUnusedLocals&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 报告未使用的本地变量的错误</span></span><br><span class="line">    <span class="attr">&quot;noUnusedParameters&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 报告未使用参数的错误</span></span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用对ES装饰器的实验性支持</span></span><br><span class="line">    <span class="attr">&quot;incremental&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 通过从以前的编译中读取/写入信息到磁盘上的文件来启用增量编译</span></span><br><span class="line">    <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;src&quot;</span> <span class="comment">// *** TypeScript文件应该进行类型检查 ***</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span> <span class="string">&quot;build&quot;</span><span class="punctuation">]</span> <span class="comment">// *** 不进行类型检查的文件 ***</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>建议来自 <code>react-typescript-cheatsheet</code> 社区</p>
</blockquote>
<h4 id="ESLint-x2F-Prettier"><a href="#ESLint-x2F-Prettier" class="headerlink" title="ESLint &#x2F; Prettier"></a><code>ESLint</code> &#x2F; <code>Prettier</code></h4><p>为了确保你的代码遵循项目或团队的规则，并且样式保持一致，建议你设置  <code>ESLint</code> 和 <code>Prettier</code> 。为了让它们配合的很好，请按照以下步骤进行设置。</p>
<ol>
<li><p>安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-plugin-react --dev</span><br></pre></td></tr></table></figure></li>
<li><p>在根目录下创建一个 <code>eslintrc.js</code> 文件并添加以下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  &#123;</span><br><span class="line">  <span class="attr">parser</span>:  <span class="string">&#x27;@typescript-eslint/parser&#x27;</span>,  <span class="comment">// 指定ESLint解析器</span></span><br><span class="line">  <span class="attr">extends</span>:  [</span><br><span class="line">    <span class="string">&#x27;plugin:react/recommended&#x27;</span>,  <span class="comment">// 使用来自 @eslint-plugin-react 的推荐规则</span></span><br><span class="line">    <span class="string">&#x27;plugin:@typescript-eslint/recommended&#x27;</span>,  <span class="comment">// 使用来自@typescript-eslint/eslint-plugin的推荐规则</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">parserOptions</span>:  &#123;</span><br><span class="line">  <span class="attr">ecmaVersion</span>:  <span class="number">2018</span>,  <span class="comment">// 允许解析最新的 ECMAScript 特性</span></span><br><span class="line">  <span class="attr">sourceType</span>:  <span class="string">&#x27;module&#x27;</span>,  <span class="comment">// 允许使用 import</span></span><br><span class="line">  <span class="attr">ecmaFeatures</span>:  &#123;</span><br><span class="line">    <span class="attr">jsx</span>:  <span class="literal">true</span>,  <span class="comment">// 允许对JSX进行解析</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>:  &#123;</span><br><span class="line">    <span class="comment">// 自定义规则</span></span><br><span class="line">    <span class="comment">// e.g. &quot;@typescript-eslint/explicit-function-return-type&quot;: &quot;off&quot;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">settings</span>:  &#123;</span><br><span class="line">    <span class="attr">react</span>:  &#123;</span><br><span class="line">      <span class="attr">version</span>:  <span class="string">&#x27;detect&#x27;</span>,  <span class="comment">// 告诉 eslint-plugin-react 自动检测 React 的版本</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加 Prettier 依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add prettier eslint-config-prettier eslint-plugin-prettier --dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>在根目录下创建一个 <code>.prettierrc.js</code> 文件并添加以下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">semi</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">trailingComma</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">  <span class="attr">singleQuote</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">printWidth</span>: <span class="number">120</span>,</span><br><span class="line">  <span class="attr">tabWidth</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>更新 <code>.eslintrc.js</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">parser</span>: <span class="string">&#x27;@typescript-eslint/parser&#x27;</span>, <span class="comment">// 指定ESLint解析器</span></span><br><span class="line">  <span class="attr">extends</span>: [</span><br><span class="line">    <span class="string">&#x27;plugin:react/recommended&#x27;</span>, <span class="comment">// 使用来自 @eslint-plugin-react 的推荐规则</span></span><br><span class="line">    <span class="string">&#x27;plugin:@typescript-eslint/recommended&#x27;</span>, <span class="comment">// 使用来自@typescript-eslint/eslint-plugin的推荐规则</span></span><br><span class="line">    <span class="string">&#x27;prettier/@typescript-eslint&#x27;</span>, <span class="comment">// 使用 ESLint -config-prettier 禁用来自@typescript-eslint/ ESLint 与 prettier 冲突的 ESLint 规则</span></span><br><span class="line">    <span class="string">&#x27;plugin:prettier/recommended&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="number">2018</span>, <span class="comment">// 允许解析最新的 ECMAScript 特性</span></span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>, <span class="comment">// 允许使用 import</span></span><br><span class="line">    <span class="attr">ecmaFeatures</span>: &#123;</span><br><span class="line">      <span class="attr">jsx</span>: <span class="literal">true</span>, <span class="comment">// 允许对JSX进行解析</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// 自定义规则</span></span><br><span class="line">    <span class="comment">// e.g. &quot;@typescript-eslint/explicit-function-return-type&quot;: &quot;off&quot;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">settings</span>: &#123;</span><br><span class="line">    <span class="attr">react</span>: &#123;</span><br><span class="line">      <span class="attr">version</span>: <span class="string">&#x27;detect&#x27;</span>, <span class="comment">// 告诉 eslint-plugin-react 自动检测 React 的版本</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="VSCode-扩展和设置"><a href="#VSCode-扩展和设置" class="headerlink" title="VSCode 扩展和设置"></a>VSCode 扩展和设置</h4><p>我们添加了 <code>ESLint</code> 和 <code>Prettier</code> ，下一步就是在保存时自动修复&#x2F;美化我们的代码。</p>
<p>首先，安装 <code>VSCode</code> 的 <code>ESLint extension</code> 和 <code>Prettier extension</code> 。这将使 <code>ESLint</code> 与您的编辑器无缝集成。</p>
<p>接下来，通过将以下内容添加到您的中来更新工作区设置 <code>.vscode/settings.json</code> ：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;editor.formatOnSave&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>保存时， <code>VS Code</code> 会发挥它的魔力并修复您的代码。很棒！</p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p><code>React</code> 的核心概念之一是组件。在这里，我们将引用 <code>React v16.8</code> 以后的标准组件，这意味着使用 Hook 而不是类的组件。</p>
<p>通常，一个基本的组件有很多需要关注的地方。让我们看一个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明式写法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Heading</span>(<span class="params"></span>): <span class="title class_">React</span>.<span class="property">ReactNode</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>My Website Heading<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数扩展式写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OtherHeading</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>My Website Heading<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>注意这里的关键区别。在第一个例子中，我们使用函数声明式写法，我们注明了这个函数返回值是 <code>React.ReactNode</code> 类型。相反，第二个例子使用了一个函数表达式。因为第二个实例返回一个函数，而不是一个值或表达式，所以我们我们注明了这个函数返回值是 <code>React.FC</code> 类型。</p>
<p>记住这两种方式可能会让人混淆。这主要取决于设计选择。无论您选择在项目中使用哪个，都要始终如一地使用它。</p>
<h4 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h4><p>我们将介绍的下一个核心概念是 <code>Props</code>。你可以使用 <code>interface</code> 或 <code>type</code> 来定义 <code>Props</code> 。让我们看另一个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">color</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">OtherProps</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">color</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notice here we&#x27;re using the function declaration with the interface Props</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Heading</span>(<span class="params">&#123; name, color &#125;: Props</span>): <span class="title class_">React</span>.<span class="property">ReactNode</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>My Website Heading<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notice here we&#x27;re using the function expression with the type OtherProps</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OtherHeading</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">OtherProps</span>&gt; = <span class="function">(<span class="params">&#123; name, color &#125;</span>) =&gt;</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>My Website Heading<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>关于 <code>interface</code> 或 <code>type</code> ，我们建议遵循 <code>react-typescript-cheatsheet</code> 社区提出的准则：</p>
<blockquote>
<p>在编写库或第三方环境类型定义时，始终将 <code>interface</code> 用于公共 <code>API</code> 的定义。<br>考虑为你的 <code>React</code> 组件的 <code>State</code> 和 <code>Props</code> 使用 <code>type</code> ，因为它更受约束。”</p>
</blockquote>
<p>让我们再看一个示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type <span class="title class_">Props</span> = &#123;</span><br><span class="line">   <span class="comment">/** color to use for the background */</span></span><br><span class="line">  color?: string;</span><br><span class="line">   <span class="comment">/** standard children prop: accepts any valid React Node */</span></span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">   <span class="comment">/** callback function passed to the onClick handler*/</span></span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">()  =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">&#123; children, color = <span class="string">&#x27;tomato&#x27;</span>, onClick &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">color</span> &#125;&#125; <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在此 <code>&lt;Button /&gt;</code> 组件中，我们为 <code>Props</code> 使用 <code>type</code>。每个 <code>Props</code> 上方都有简短的说明，以为其他开发人员提供更多背景信息。<code>?</code> 表示 <code>Props</code> 是可选的。<code>children props</code> 是一个 <code>React</code>.<code>ReactNode</code> 表示它还是一个 <code>React</code> 组件。</p>
<p>通常，在 <code>React</code> 和 <code>TypeScript</code> 项目中编写 <code>Props</code> 时，请记住以下几点：</p>
<blockquote>
<p>始终使用 <code>TSDoc</code> 标记为你的 <code>Props</code> 添加描述性注释 <code>/** comment */</code>。<br>无论你为组件 <code>Props</code> 使用 <code>type</code> 还是 <code>interfaces</code> ，都应始终使用它们。<br>如果 <code>props</code> 是可选的，请适当处理或使用默认值。</p>
</blockquote>
<h3 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h3><p>幸运的是，当使用 <code>Hook</code> 时， <code>TypeScript</code> 类型推断工作得很好。这意味着你没有什么好担心的。举个例子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `value` is inferred as a string</span></span><br><span class="line"><span class="comment">// `setValue` is inferred as (newValue: string) =&gt; void</span></span><br><span class="line"><span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>TypeScript</code> 推断出 <code>useState</code> 钩子给出的值。这是一个 <code>React</code> 和 TypeScript 协同工作的成果。</p>
<p>在极少数情况下，你需要使用一个空值初始化 <code>Hook</code> ，可以使用泛型并传递联合以正确键入 <code>Hook</code> 。查看此实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">email</span>: string;</span><br><span class="line">  <span class="attr">id</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the generic is the &lt; &gt;</span></span><br><span class="line"><span class="comment">// the union is the User | null</span></span><br><span class="line"><span class="comment">// together, TypeScript knows, &quot;Ah, user can be User or null&quot;.</span></span><br><span class="line"><span class="keyword">const</span> [user, setUser] = useState&lt;<span class="title class_">User</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>下面是一个使用 userReducer 的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">AppState</span> = &#123;&#125;;</span><br><span class="line">type <span class="title class_">Action</span> =</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&quot;SET_ONE&quot;</span>; <span class="attr">payload</span>: string &#125;</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&quot;SET_TWO&quot;</span>; <span class="attr">payload</span>: number &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state: AppState, action: Action</span>): <span class="title class_">AppState</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;SET_ONE&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">one</span>: action.<span class="property">payload</span> <span class="comment">// `payload` is string</span></span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;SET_TWO&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">two</span>: action.<span class="property">payload</span> <span class="comment">// `payload` is number</span></span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见，<code>Hooks</code> 并没有为 <code>React</code> 和 <code>TypeScript</code> 项目增加太多复杂性。</p>
<h4 id="常见用例"><a href="#常见用例" class="headerlink" title="常见用例"></a>常见用例</h4><p>本节将介绍人们在将 <code>TypeScript</code> 与 <code>React</code> 结合使用时一些常见的坑。我们希望通过分享这些知识，您可以避免踩坑，甚至可以与他人分享这些知识。</p>
<h4 id="处理表单事件"><a href="#处理表单事件" class="headerlink" title="处理表单事件"></a>处理表单事件</h4><p>最常见的情况之一是 <code>onChange</code> 在表单的输入字段上正确键入使用的。这是一个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyInput</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 事件类型是“ChangeEvent”</span></span><br><span class="line">  <span class="comment">// 我们将 “HTMLInputElement” 传递给 input</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onChange</span>(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) &#123;</span><br><span class="line">    <span class="title function_">setValue</span>(e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span> <span class="attr">id</span>=<span class="string">&quot;input-example&quot;</span>/&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="扩展组件的-Props"><a href="#扩展组件的-Props" class="headerlink" title="扩展组件的 Props"></a>扩展组件的 Props</h4><p>有时，您希望获取为一个组件声明的 <code>Props</code>，并对它们进行扩展，以便在另一个组件上使用它们。但是你可能想要修改一两个属性。还记得我们如何看待两种类型组件 <code>Props</code>、<code>type</code> 或 <code>interfaces</code> 的方法吗?取决于你使用的组件决定了你如何扩展组件 <code>Props</code> 。让我们先看看如何使用 <code>type</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">ButtonProps</span> = &#123;</span><br><span class="line">    <span class="comment">/** the background color of the button */</span></span><br><span class="line">    <span class="attr">color</span>: string;</span><br><span class="line">    <span class="comment">/** the text to show inside the button */</span></span><br><span class="line">    <span class="attr">text</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">ContainerProps</span> = <span class="title class_">ButtonProps</span> &amp; &#123;</span><br><span class="line">    <span class="comment">/** the height of the container (value used with &#x27;px&#x27;) */</span></span><br><span class="line">    <span class="attr">height</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Container</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">ContainerProps</span>&gt; = <span class="function">(<span class="params">&#123; color, height, width, text &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">color</span>, <span class="attr">height:</span> `$&#123;<span class="attr">height</span>&#125;<span class="attr">px</span>` &#125;&#125;&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你使用 <code>interface</code> 来声明 <code>props</code>，那么我们可以使用关键字 <code>extends</code> 从本质上“扩展”该接口，但要进行一些修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">    <span class="comment">/** the background color of the button */</span></span><br><span class="line">    <span class="attr">color</span>: string;</span><br><span class="line">    <span class="comment">/** the text to show inside the button */</span></span><br><span class="line">    <span class="attr">text</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ContainerProps</span> <span class="keyword">extends</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">    <span class="comment">/** the height of the container (value used with &#x27;px&#x27;) */</span></span><br><span class="line">    <span class="attr">height</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Container</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">ContainerProps</span>&gt; = <span class="function">(<span class="params">&#123; color, height, width, text &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">color</span>, <span class="attr">height:</span> `$&#123;<span class="attr">height</span>&#125;<span class="attr">px</span>` &#125;&#125;&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两种方法都可以解决问题。由您决定使用哪个。就个人而言，扩展 <code>interface</code> 更具可读性，但最终取决于你和你的团队。</p>
<h4 id="第三方库"><a href="#第三方库" class="headerlink" title="第三方库"></a>第三方库</h4><p>无论是用于诸如 <code>Apollo</code> 之类的 <code>GraphQL</code> 客户端还是用于诸如 <code>React Testing Library</code> 之类的测试，我们经常会在 <code>React</code> 和 <code>TypeScript</code> 项目中使用第三方库。发生这种情况时，你要做的第一件事就是查看这个库是否有一个带有 <code>TypeScript</code> 类型定义 <code>@types</code> 包。你可以通过运行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yarn</span></span><br><span class="line">yarn add @types/&lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#npm</span></span><br><span class="line">npm install @types/&lt;package-name&gt;</span><br></pre></td></tr></table></figure>

<p>例如，如果您使用的是 <code>Jest</code> ，则可以通过运行以下命令来实现：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yarn</span></span><br><span class="line">yarn add @types/jest</span><br><span class="line"></span><br><span class="line"><span class="comment">#npm</span></span><br><span class="line">npm install @types/jest</span><br></pre></td></tr></table></figure>

<p>这样，每当在项目中使用 <code>Jest</code> 时，就可以增加类型安全性。</p>
<p>该 <code>@types</code> 命名空间被保留用于包类型定义。它们位于一个名为 <code>DefinitelyTyped</code> 的存储库中，该存储库由 <code>TypeScript</code> 团队和社区共同维护。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>由于信息量大，以最佳方式一起使用 <code>React</code> 和 <code>TypeScript</code> 需要一些学习时间，但是从长远来看，其收益是巨大的。在本文中，我们介绍了<code>配置</code>、<code>组件</code>、<code>Props</code>、<code>Hook</code>、<code>常见用例</code> 和 <code>第三方库</code>。尽管我们可以更深入地研究各个领域，但这应涵盖帮助您遵循最佳实践所需的 <code>80％</code> 。</p>
<p>如果您希望看到它的实际效果，可以在 <code>GitHub</code> 上看到这个示例。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/21/iOS-5G-%E7%BD%91%E7%BB%9C%E7%9B%91%E6%B5%8B%E5%8F%8A%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/21/iOS-5G-%E7%BD%91%E7%BB%9C%E7%9B%91%E6%B5%8B%E5%8F%8A%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/" class="post-title-link" itemprop="url">iOS 5G 网络监测及可能遇到的坑</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-21 11:24:28" itemprop="dateCreated datePublished" datetime="2020-12-21T11:24:28+08:00">2020-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-01-07 18:11:05" itemprop="dateModified" datetime="2021-01-07T18:11:05+08:00">2021-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p> 最近在 review 项目时，发现项目上的网络监测没有适配 5G 网络，欲适配之。然在测试过程中发现，缺少在 iOS 14.0.1 的设备上，启动会闪退。debug 发现是 CTRadioAccessTechnologyNRNSA 在 iOS 14.0.1 下不存在，导致闪退。</p>
<h3 id="Apple-的-CTTelephonyNetworkInfo-h-中的定义"><a href="#Apple-的-CTTelephonyNetworkInfo-h-中的定义" class="headerlink" title="Apple 的 CTTelephonyNetworkInfo.h 中的定义"></a>Apple 的 CTTelephonyNetworkInfo.h 中的定义</h3> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Radio Access Technology values</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyGPRS</span>          API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyEdge</span>          API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyWCDMA</span>         API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyHSDPA</span>         API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyHSUPA</span>         API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyCDMA1x</span>        API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyCDMAEVDORev0</span>  API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyCDMAEVDORevA</span>  API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyCDMAEVDORevB</span>  API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyeHRPD</span>         API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyLTE</span>           API_AVAILABLE(ios(<span class="number">7.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyNRNSA</span>         API_AVAILABLE(ios(<span class="number">14.0</span>)) API_UNAVAILABLE(macos);</span><br><span class="line">CORETELEPHONY_EXTERN <span class="built_in">NSString</span> * <span class="keyword">const</span> <span class="built_in">CTRadioAccessTechnologyNR</span>            API_AVAILABLE(ios(<span class="number">14.0</span>)) API_UNAVAILABLE(macos);</span><br></pre></td></tr></table></figure>

<p>从 CTTelephonyNetworkInfo.h 中可以发现，5G 网络新增了 CTRadioAccessTechnologyNRNSA、CTRadioAccessTechnologyNR 2 个 value，并且都是 API_AVAILABLE(ios(14.0)) ，即都是从 iOS 14.0 开始可以使用。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 故适配 5G 网络只需增加</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __IPHONE_14_0</span></span><br><span class="line">        <span class="keyword">if</span> (@available(iOS <span class="number">14.0</span>, *)) &#123;</span><br><span class="line">            <span class="keyword">self</span>.type5G = @[<span class="built_in">CTRadioAccessTechnologyNRNSA</span>,</span><br><span class="line">                            <span class="built_in">CTRadioAccessTechnologyNR</span>];</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>然而，debug 时会发现，在 iOS 14.0.1 的设备在 CTRadioAccessTechnologyNRNSA 报 crash 错误。回想之前 Apple Pay 的适配时出现的问题，将适配代码修改成如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __IPHONE_14_1</span></span><br><span class="line">        <span class="keyword">if</span> (@available(iOS <span class="number">14.1</span>, *)) &#123;</span><br><span class="line">            <span class="keyword">self</span>.type5G = @[<span class="built_in">CTRadioAccessTechnologyNRNSA</span>,</span><br><span class="line">                            <span class="built_in">CTRadioAccessTechnologyNR</span>];</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>修改成 @available(iOS 14.1, *) 后，在 iOS 14.0.1 的设备上运行正常。</p>
<p>之后在网络上搜索发现，我不是第一个遇到这个问题的开发者。参见 <a target="_blank" rel="noopener" href="https://blog.csdn.net/myiphon/article/details/109842362">blog</a> 及回复。</p>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><p>自 iOS 13 发布以来，iOS 系统爆发了好几次比较严重的问题。希望 Cook 未来最优可能的继任者 <a target="_blank" rel="noopener" href="https://www.apple.com.cn/leadership/craig-federighi/">Craig Federighi</a> 能扭转这一问题，保持 iOS 系统的研发稳定有序迭代。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/12/macOS-VSCode%E7%8E%AF%E5%A2%83%E4%B8%8B-%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%B8%E8%BD%BDGo%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/12/macOS-VSCode%E7%8E%AF%E5%A2%83%E4%B8%8B-%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%B8%E8%BD%BDGo%E7%8E%AF%E5%A2%83/" class="post-title-link" itemprop="url">macOS+VSCode环境下,安装和卸载Go环境</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-12 16:43:06" itemprop="dateCreated datePublished" datetime="2020-11-12T16:43:06+08:00">2020-11-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-27 10:30:01" itemprop="dateModified" datetime="2023-09-27T10:30:01+08:00">2023-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" itemprop="url" rel="index"><span itemprop="name">开发环境</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>最近在查看后台 API 文档，在自己电脑上需要搭建 Go 环境。网上很多基于 macOS、VSCode 的环境搭建教程都落后了，不够与时俱进，顾将这次 macOS + VSCode + Go 环境搭建记录下来。</p>
</blockquote>
<p>本文介绍以下几个问题：</p>
<ol>
<li>Go 环境的安装</li>
<li>VSCode 集成 Go 开发环境及插件</li>
<li>Go 环境的卸载</li>
</ol>
<h2 id="Go-环境的安装"><a href="#Go-环境的安装" class="headerlink" title="Go 环境的安装"></a>Go 环境的安装</h2><blockquote>
<p>Go 安装可以通过图形可视化安装<a target="_blank" rel="noopener" href="https://golang.org/dl/">官网下载链接</a>。本文是基于 macOS，通过 HomeBrew，命令行安装更简便，后续升级维护简便。</p>
</blockquote>
<p>直接执行以下命令来安装Go：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install go</span><br></pre></td></tr></table></figure>

<p>此时可能会卡在 Updating Homebrew，可以通过切换中科大源来解决：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 替换brew.git:</span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span></span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br><span class="line"></span><br><span class="line">// 替换homebrew-core.git:</span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core&quot;</span></span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br></pre></td></tr></table></figure>

<p>然后就可以顺利安装了。安装完成后，可以在终端执行以下命令来测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>

<p>此时会在终端显示go版本：</p>
<p><img src="/images/upload/image-20201112162352406.png" alt="img"></p>
<h3 id="Go环境变量配置"><a href="#Go环境变量配置" class="headerlink" title="Go环境变量配置"></a>Go环境变量配置</h3><p>在 <code>Go 1.13</code> 之后，无需再通过设置系统环境变量的方式来修改，可以通过 <code>go env -w</code> 命令来设置 Go 的环境变量。<br>需要设置的环境变量如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于存放依赖包以及编译文件，比较随意，只要不和GOROOT重名即可，官方禁止这一行为</span></span><br><span class="line">go env -w <span class="variable constant_">GOPATH</span>=<span class="regexp">/Users/u</span>sername/go</span><br><span class="line"><span class="comment">// 设置代理后，在未翻墙的情况下，打开vscode后gopls工具的加载会很快</span></span><br><span class="line">go env -w <span class="variable constant_">GOPROXY</span>=<span class="attr">https</span>:<span class="comment">//goproxy.cn,direct</span></span><br></pre></td></tr></table></figure>

<h3 id="VSCode-集成-Go-开发环境及插件"><a href="#VSCode-集成-Go-开发环境及插件" class="headerlink" title="VSCode 集成 Go 开发环境及插件"></a>VSCode 集成 Go 开发环境及插件</h3><ol>
<li><p>VSCode 安装 Go 插件<br>在插件商店中搜索 <code>Go(Publish By Go Team at Google)</code>，并点击安装即可。<br>插件安装好后，用 VSCode 打开一个 <code>.go</code> 的文件，会提示安装 Go 相关插件，根据个人需求点击提示上的 <code>Install</code> 或者 <code>Install All</code>，稍等片刻会看到插件都已经安装 <code>SUCCSESS</code>。</p>
</li>
<li><p>使用Git下载源代码安装<br>先在自己的 <code>$GOPATH</code> 的 <code>src</code> 目录下创建 <code>golang.org/x</code> 的目录，查看 <code>$GOPATH</code> 使用命令 <code>go env</code></p>
</li>
<li><p>打开终端，<code>cd</code> 到 <code>$GOPATH/golang.org/x</code> 目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行命令，这步不需要任何代理，国内网站即可完成，无需设置任何的GOPROXY</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/tools.git tools</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/lint.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开 <code>VSCode</code>，按下 <code>command+shift+p</code>，再次执行 <code>Go:Install/Update Tools</code> 命令，在弹出窗口中全选并点击确定，然后就会出现全部<code>SUCCESSED</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Tools environment: GOPATH=/Users/darren/go</span><br><span class="line">Installing 18 tools at /Users/darren/go/bin <span class="keyword">in</span> module mode.</span><br><span class="line"> gocode</span><br><span class="line"> gopkgs</span><br><span class="line"> go-outline</span><br><span class="line"> go-symbols</span><br><span class="line"> guru</span><br><span class="line"> gorename</span><br><span class="line"> gotests</span><br><span class="line"> gomodifytags</span><br><span class="line"> impl</span><br><span class="line"> fillstruct</span><br><span class="line"> goplay</span><br><span class="line"> godoctor</span><br><span class="line"> dlv</span><br><span class="line"> gocode-gomod</span><br><span class="line"> godef</span><br><span class="line"> goreturns</span><br><span class="line"> golint</span><br><span class="line"> gopls</span><br><span class="line"></span><br><span class="line"> Installing github.com/mdempsky/gocode (/Users/darren/go/bin/gocode) SUCCEEDED</span><br><span class="line"> Installing github.com/uudashr/gopkgs/v2/cmd/gopkgs (/Users/darren/go/bin/gopkgs) SUCCEEDED</span><br><span class="line"> Installing github.com/ramya-rao-a/go-outline (/Users/darren/go/bin/go-outline) SUCCEEDED</span><br><span class="line"> Installing github.com/acroca/go-symbols (/Users/darren/go/bin/go-symbols) SUCCEEDED</span><br><span class="line"> Installing golang.org/x/tools/cmd/guru (/Users/darren/go/bin/guru) SUCCEEDED</span><br><span class="line"> Installing golang.org/x/tools/cmd/gorename (/Users/darren/go/bin/gorename) SUCCEEDED</span><br><span class="line"> Installing github.com/cweill/gotests/... (/Users/darren/go/bin/gotests) SUCCEEDED</span><br><span class="line"> Installing github.com/fatih/gomodifytags (/Users/darren/go/bin/gomodifytags) SUCCEEDED</span><br><span class="line"> Installing github.com/josharian/impl (/Users/darren/go/bin/impl) SUCCEEDED</span><br><span class="line"> Installing github.com/davidrjenni/reftools/cmd/fillstruct (/Users/darren/go/bin/fillstruct) SUCCEEDED</span><br><span class="line"> Installing github.com/haya14busa/goplay/cmd/goplay (/Users/darren/go/bin/goplay) SUCCEEDED</span><br><span class="line"> Installing github.com/godoctor/godoctor (/Users/darren/go/bin/godoctor) SUCCEEDED</span><br><span class="line"> Installing github.com/go-delve/delve/cmd/dlv (/Users/darren/go/bin/dlv) SUCCEEDED</span><br><span class="line"> Installing github.com/stamblerre/gocode (/Users/darren/go/bin/gocode-gomod) SUCCEEDED</span><br><span class="line"> Installing github.com/rogpeppe/godef (/Users/darren/go/bin/godef) SUCCEEDED</span><br><span class="line"> Installing github.com/sqs/goreturns (/Users/darren/go/bin/goreturns) SUCCEEDED</span><br><span class="line"> Installing golang.org/x/lint/golint (/Users/darren/go/bin/golint) SUCCEEDED</span><br><span class="line"> Installing golang.org/x/tools/gopls (/Users/darren/go/bin/gopls) SUCCEEDED</span><br><span class="line"></span><br><span class="line"> All tools successfully installed. You are ready to Go :).</span><br></pre></td></tr></table></figure>

<p> 至此，所有 Golang 基础插件都安装完成。</p>
</li>
</ol>
<h2 id="Go-环境的卸载"><a href="#Go-环境的卸载" class="headerlink" title="Go 环境的卸载"></a>Go 环境的卸载</h2><ol>
<li><p>删除 <code>/usr/local</code> 下的 <code>go</code> 目录。</p>
<blockquote>
<p>备注：这个目录是安装 <code>go</code> 的时候自动生成的。 如果删除完，终端中使用 <code>go version</code> 命令，会报找不到 <code>go</code> 命令。</p>
</blockquote>
</li>
<li><p>删除 Path 环境变量。</p>
<blockquote>
<p>备注：这里，我只是想删除一个 Go 版本， 所以， <code>GOPATH</code> 还是需要的。</p>
</blockquote>
</li>
<li><p>删除配置文件信息：在 <code>/etc/profile</code> 或者 <code>$HOME/.profile</code> 或者 <code>$HOME/.bahs_profile</code> 中删除 <code>bin</code> 的设置。</p>
</li>
<li><p>删除 macOS 的安装包文件，在 <code>/etc/paths.d/go</code> 目录下。</p>
<blockquote>
<p>我只用了第一步，重新安装，其他都还继续使用。</p>
</blockquote>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/11/git-%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/11/git-%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">git 规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-11 14:55:44" itemprop="dateCreated datePublished" datetime="2020-11-11T14:55:44+08:00">2020-11-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-08 15:21:00" itemprop="dateModified" datetime="2020-12-08T15:21:00+08:00">2020-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Git 规范一般包括两点：分支管理规范、git commit 规范。</p>
</blockquote>
<h3 id="分支管理规范"><a href="#分支管理规范" class="headerlink" title="分支管理规范"></a>分支管理规范</h3><p>一般项目分主分支（master）和其他分支。<br>当需要开发新功能或修复 Bug 时，从 master 分支开一个新的分支。例如项目要从客户端渲染改成服务端渲染，就开一个分支叫 ssr，开发完了再合并回 master 分支。<br>如果需要修复一个 Bug，可以从 master 分支开一个新分支，并用 Bug 号命名（一般小团队嫌麻烦，没这样做，除非有特别大的 Bug）。</p>
<h3 id="git-commit-规范"><a href="#git-commit-规范" class="headerlink" title="git commit 规范"></a>git commit 规范</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">type</span>&gt;</span></span>(<span class="language-xml"><span class="tag">&lt;<span class="name">scope</span>&gt;</span></span>): <span class="language-xml"><span class="tag">&lt;<span class="name">subject</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">BLANK</span> <span class="attr">LINE</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">BLANK</span> <span class="attr">LINE</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>大致分为三个部分(使用空行分割):</p>
<ol>
<li>标题行: 必填, 描述主要修改类型和内容。</li>
<li>主题内容: 描述为什么修改, 做了什么样的修改, 以及开发的思路等等。</li>
<li>页脚注释: 可以写注释，Bug 号链接。</li>
</ol>
<h4 id="type-commit-的类型"><a href="#type-commit-的类型" class="headerlink" title="type: commit 的类型"></a>type: commit 的类型</h4><ul>
<li>feat: 新功能、新特性</li>
<li>fix: 修改 bug</li>
<li>perf: 更改代码，以提高性能</li>
<li>refactor: 代码重构（重构，在不影响代码内部行为、功能下的代码修改）</li>
<li>docs: 文档修改</li>
<li>style: 代码格式修改, 注意不是 css 修改（例如分号修改）</li>
<li>test: 测试用例新增、修改</li>
<li>build: 影响项目构建或依赖项修改</li>
<li>revert: 恢复上一次提交</li>
<li>ci: 持续集成相关文件修改</li>
<li>chore: 其他修改（不在上述类型中的修改）</li>
<li>release: 发布新版本</li>
<li>workflow: 工作流相关文件修改</li>
</ul>
<ol>
<li>scope: commit 影响的范围, 比如: route, component, utils, build…</li>
<li>subject: commit 的概述</li>
<li>body: commit 具体修改内容, 可以分为多行.</li>
<li>footer: 一些备注, 通常是 BREAKING CHANGE 或修复的 bug 的链接.</li>
</ol>
<p>示例</p>
<h5 id="fix（修复-Bug）"><a href="#fix（修复-Bug）" class="headerlink" title="fix（修复 Bug）"></a>fix（修复 Bug）</h5><p>如果修复的这个 Bug 只影响当前修改的文件，可不加范围。如果影响的范围比较大，要加上范围描述。</p>
<p>例如这次 Bug 修复影响到全局，可以加个 global。如果影响的是某个目录或某个功能，可以加上该目录的路径，或者对应的功能名称。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1</span></span><br><span class="line"><span class="title function_">fix</span>(<span class="variable language_">global</span>):修复checkbox不能复选的问题</span><br><span class="line"><span class="comment">// 示例2 下面圆括号里的 common 为通用管理的名称</span></span><br><span class="line"><span class="title function_">fix</span>(common): 修复字体过小的<span class="variable constant_">BUG</span>，将通用管理下所有页面的默认字体大小修改为 14px</span><br><span class="line"><span class="comment">// 示例3</span></span><br><span class="line"><span class="attr">fix</span>: value.<span class="property">length</span> -&gt; values.<span class="property">length</span></span><br></pre></td></tr></table></figure>

<h5 id="feat（添加新功能或新页面）"><a href="#feat（添加新功能或新页面）" class="headerlink" title="feat（添加新功能或新页面）"></a>feat（添加新功能或新页面）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feat</span>: 添加网站主页静态页面</span><br><span class="line"></span><br><span class="line">这是一个示例，假设对点检任务静态页面进行了一些描述。</span><br><span class="line"></span><br><span class="line">这里是备注，可以是放<span class="variable constant_">BUG</span>链接或者一些重要性的东西。</span><br></pre></td></tr></table></figure>

<h5 id="chore（其他修改）"><a href="#chore（其他修改）" class="headerlink" title="chore（其他修改）"></a>chore（其他修改）</h5><p>chore 的中文翻译为日常事务、例行工作，顾名思义，即不在其他 commit 类型中的修改，都可以用 chore 表示。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">chore</span>: 将表格中的查看详情改为详情</span><br></pre></td></tr></table></figure>

<p>其他类型的 commit 和上面三个示例差不多，就不说了。</p>
<h4 id="验证-git-commit-规范"><a href="#验证-git-commit-规范" class="headerlink" title="验证 git commit 规范"></a>验证 git commit 规范</h4><p>验证 git commit 规范，主要通过 git 的 <code>pre-commit</code> 钩子函数来进行。当然，你还需要下载一个辅助工具来帮助你进行验证。</p>
<p>下载辅助工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D husky</span><br></pre></td></tr></table></figure>

<p>在 <code>package.json</code> 加上下面的代码</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;husky&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run lint&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commit-msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node script/verify-commit.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pre-push&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm test&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后在你项目根目录下新建一个文件夹 <code>script</code>，并在下面新建一个文件 <code>verify-commit.js</code>，输入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> msgPath = process.<span class="property">env</span>.<span class="property">HUSKY_GIT_PARAMS</span></span><br><span class="line"><span class="keyword">const</span> msg = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">.<span class="title function_">readFileSync</span>(msgPath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">.<span class="title function_">trim</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commitRE = <span class="regexp">/^(feat|fix|docs|style|refactor|perf|test|workflow|build|ci|chore|release|workflow)(\(.+\))?: .&#123;1,50&#125;/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!commitRE.<span class="title function_">test</span>(msg)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`</span></span><br><span class="line"><span class="string">        不合法的 commit 消息格式。</span></span><br><span class="line"><span class="string">        请查看 git commit 提交规范：https://github.com/woai3c/Front-end-articles/blob/master/git%20commit%20style.md</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line"></span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在来解释下各个钩子的含义：</p>
<ol>
<li><code>&quot;pre-commit&quot;: &quot;npm run lint&quot;</code>，在 <code>git commit</code> 前执行 <code>npm run lint</code> 检查代码格式。</li>
<li><code>&quot;commit-msg&quot;: &quot;node script/verify-commit.js&quot;</code>，在 <code>git commit</code> 时执行脚本 <code>verify-commit.js</code> 验证 commit 消息。如果不符合脚本中定义的格式，将会报错。</li>
<li><code>&quot;pre-push&quot;: &quot;npm test&quot;</code>，在你执行 <code>git push</code> 将代码推送到远程仓库前，执行 <code>npm test</code> 进行测试。如果测试失败，将不会执行这次推送。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/06/App-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/06/App-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">App 启动速度优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-06 11:11:52" itemprop="dateCreated datePublished" datetime="2020-11-06T11:11:52+08:00">2020-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-27 10:30:01" itemprop="dateModified" datetime="2023-09-27T10:30:01+08:00">2023-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>公司的项目，线上功能逐渐稳定，维持在一个月或者半个月稳定发布一次新的版本，下一步我们需要考虑的就是性能方面的优化了。而启动速度，是我们的项目给用户的第一印象，尤为重要，如果启动速度缓慢，会造成比较严重的用户流失，所以，对启动速度的优化，将会成为我们后期开发工作中不可或缺的一部分。</p>
<p>首先，第一步我们需要知道 APP 启动时都做了什么事，从而在对症下药，探索可行的优化方式。</p>
<h2 id="APP启动"><a href="#APP启动" class="headerlink" title="APP启动"></a>APP启动</h2><h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><p>对于冷启动和热启动这两个名词，相信你一定不陌生吧。</p>
<ul>
<li>冷启动：是指启动前并没有进程在系统里，需要系统新创建一个进程供 APP 使用的启动情况</li>
<li>热启动：和热启动相对应，是APP的进程在系统中，用户重新启动进入 APP 的过程，如果把 APP 进程杀掉，然后立刻重启，也属于热启动因为进程的缓存还在</li>
</ul>
<p>其实，从用户可感知的维度去看呢，就是用户在手机桌面，点击 APP 图标，到 APP 启动图完全消失，首页第一帧渲染完成的过程。所以，本文我们就只展开说 APP 冷启动的流程和优化。</p>
<p>下面我们先来搞清楚 APP 启动时都做了哪些事儿。</p>
<h3 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h3><p>总的来说 APP 启动主要包括三个阶段：</p>
<ol>
<li>main() 函数执行前</li>
<li>main() 函数执行后</li>
<li>首屏渲染完成后</li>
</ol>
<p>关于 APP 启动时间，主要由 pre-main 和 main 之后的时间组成，即：总的启动时间 &#x3D; main 之前加载的时间 + main 之后加载的时间。启动时间越接近 400ms 越好，并且最好控制在 20s 以内，不然系统会以为 APP 进入一个死循环，应用进程将会被系统强制杀除。</p>
<p>下面我们继续分别说一说这三个阶段系统都做了什么事情。</p>
<h4 id="main-函数执行前"><a href="#main-函数执行前" class="headerlink" title="main() 函数执行前"></a>main() 函数执行前</h4><p>在 main() 函数执行前，系统主要会做下面几件事：</p>
<ol>
<li>加载可执行文件( APP 的 .o 文件的集合)，就是 Mach-O 文件，这个在后面会详细介绍</li>
<li>加载动态链接库，进行 rebase 指针调整和 bind 符号绑定</li>
<li>运行时的初始化工作，包括类的注册，category 注册，selector 唯一性的检查等</li>
<li>执行 +load() 方法，attribute((constructor)) 修饰的函数的调用，创建 C++ 静态全局变量</li>
</ol>
<p>pre-main 的加载时间，可以通过添加环境变量 DYLD_PRINT_STATISTICS 的方式打印出来。</p>
<p><img src="/images/upload/image-20201029100459519.png" alt="image-20201029100459519"></p>
<p>运行的时候就可以打印出详细的 pre-main 的时间</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Total pre-main time: 1.0 seconds (100.0%)</span><br><span class="line"> dylib loading time: 608.26 milliseconds (60.3%)</span><br><span class="line">rebase/binding time:  54.06 milliseconds (5.3%)</span><br><span class="line">    ObjC setup time:  42.88 milliseconds (4.2%)</span><br><span class="line">   initializer time: 302.35 milliseconds (30.0%)</span><br><span class="line">   slowest intializers :</span><br><span class="line">     libSystem.B.dylib :   6.10 milliseconds (0.6%)</span><br><span class="line">  libglInterpose.dylib : 146.15 milliseconds (14.5%)</span><br><span class="line">          AFNetworking :  22.28 milliseconds (2.2%)</span><br><span class="line">             MJRefresh :  33.69 milliseconds (3.3%)</span><br><span class="line">                mzmall :  90.76 milliseconds (9.0%)</span><br></pre></td></tr></table></figure>

<p>可以看到 main() 方法之前的时间由 dylib loading ，rebse &#x2F; binding，ObjC setup 和 initializer 四个耗时的部分组成。</p>
<p>所以，相对应这个阶段，我们可做的优化工作如下：</p>
<ul>
<li>减少动态库加载。每个库本身都有依赖，系统会递归的加载所有依赖的动态库，所以苹果公司建议，尽量使用更少的动态库</li>
<li>减少无用的类、分类和方法</li>
<li>+load() 方法中的内容如非必要，可以放到首屏渲染完成之后再执行，或者放在 +initialize() 方法中执行。因为一个 +load() 方法会带来4毫秒的消耗</li>
<li>控制 C++ 静态全局变量的数量</li>
</ul>
<p>下面先说一说 Mach-O 是个什么？</p>
<h4 id="Mach-O"><a href="#Mach-O" class="headerlink" title="Mach-O"></a>Mach-O</h4><p>理解启动的过程，学习 Mach-O 是不可或缺的。在没有接触过启动优化的相关工作之前，你可能对 Mach-O 比较陌生，本文就来对 Mach-O 做一个简单的介绍。</p>
<p>简单来说，Mach-O 是 macOS 和 iOS 中的一种独有的二进制格式，就是可执行文件的格式。 Mach-O 格式的文件，基本结构都是由Header，Load commands 和 Data 三部分构成：</p>
<p><img src="/images/upload/image-20201029100824640.png" alt="image-20201029100824640"></p>
<p>使用 MachOView 工具可以帮助我们查看 Mach-O 文件的内容——<a target="_blank" rel="noopener" href="https://github.com/AnleSu/MachOView">MachOView 工具</a>，可以直接点击链接获取修改后的源码编译，或者安装根目录文件夹中的 pkg 包，当时我自己安装的时候，下载的安装包遇到了一些打不开和 crash 的问题，所以这里记录了一份可用的安装包，希望对你有帮助。</p>
<p><img src="/images/upload/image-20201029101822548.png" alt="image-20201029101822548"></p>
<p>下面分别说一下 Mach-O 文件的几个组成部分。</p>
<p><strong>Header</strong> 是一个结构体可以在苹果开源的内核源码中找到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mach_header_64</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span>        magic;      <span class="comment">// 64位还是32位</span></span><br><span class="line">    <span class="type">cpu_type_t</span>      cputype;    <span class="comment">// CPU 类型，比如 arm 或 X86</span></span><br><span class="line">    <span class="type">cpu_subtype_t</span>   cpusubtype; <span class="comment">// CPU 子类型，比如 armv8</span></span><br><span class="line">    <span class="type">uint32_t</span>        filetype;   <span class="comment">// 文件类型</span></span><br><span class="line">    <span class="type">uint32_t</span>        ncmds;      <span class="comment">// load commands 的数量</span></span><br><span class="line">    <span class="type">uint32_t</span>        sizeofcmds; <span class="comment">// load commands 大小</span></span><br><span class="line">    <span class="type">uint32_t</span>        flags;      <span class="comment">// 标签</span></span><br><span class="line">    <span class="type">uint32_t</span>        reserved;   <span class="comment">// 保留字段</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如上面代码所示，包含了表示是 64 位还是 32 位的 magic、CPU 类型 cputype、CPU 子类型 cpusubtype、文件类型 filetype、描述文件在虚拟内存中逻辑结构和布局的 load commands 数量和大小等文件信息。</p>
<p>其中 filetype 表示当前 Mach-O 文件属于哪种类型。Mach-O 包括以下几种类型：</p>
<ul>
<li>OBJECT  指的是 .o 文件或者 .a 文件；</li>
<li>EXECUTE，指的是 IPA 拆包后的文件；</li>
<li>DYLIB，指的是 .dylib 或 .framework 文件；</li>
<li>DYLINKER，指的是动态链接器；</li>
<li>DSYM，指的是保存有符号信息用于分析闪退信息的文件。</li>
</ul>
<p><strong>Load Commands</strong> 用于指定布局和文件的链接属性，符号表的位置，动态连接器的路径等。Load Commands 由多个 Load Command 构成，每一个 Load Command 也是一个结构体，并且不同的 Load Command 对应的结构体结构也不相同，但是所有的 Load Command 都必须存在的信息是指令类型 cmd 和指令大小 cmdsize。</p>
<p>Load Commands 中关于映射的段的详细信息都可以在 MachOView 中查看到，这些是一一对应的：</p>
<p><img src="/images/upload/image-20201029101852935.png" alt="image-20201029101852935"></p>
<p>几乎所有的 Mach-O 文件都包含3个段：_TEXT、_DATA和 _LINKEDIT</p>
<ul>
<li>__TEXT 包含 Mach header，被执行的代码和只读常量（如C 字符串）。只读（r-x）。</li>
<li>__DATA 包含全局变量，静态变量等。可读写（rw-）。</li>
<li>__LINKEDIT 包含了加载程序的『元数据』，比如函数的名称和地址。只读（r–）</li>
</ul>
<h4 id="内核流程"><a href="#内核流程" class="headerlink" title="内核流程"></a>内核流程</h4><p>加载 Mach-O 文件，内核会 fork 进程，并对进程进行一些基本操作，比如为进程分配虚拟内存、为进程创建主线程、代码签名等。整个过程可以在 <a target="_blank" rel="noopener" href="https://github.com/apple/darwin-xnu">XNU的源码</a> 中查看。</p>
<p><img src="/images/upload/image-20201029102028190.png" alt="image-20201029102028190"></p>
<p>这里就不展开说了，感兴趣的自己去扣扣源码看吧，内核做了一系列的准备以及 dyld 的加载，dyld 启动后，接下来的事情将由 dyld 完成，dyld 在程序进程上运行和程序有着相同的权限，接着就构成了下面的 dyld 的工作流水线：</p>
<p>Load dylibs -&gt; Rebase -&gt; Bind -&gt; ObjC -&gt; Initializers</p>
<h4 id="Load-dylibs"><a href="#Load-dylibs" class="headerlink" title="Load dylibs"></a>Load dylibs</h4><p>动态链接库的加载过程主要由 dyld 来完成，dyld 是苹果的动态链接器。 系统先读取 App 的可执行文件（Mach-O 文件），从里面获得dyld 的路径，然后加载 dyld，dyld 去初始化运行环境，开启缓存策略，加载程序相关依赖库(其中也包含我们的可执行文件)，并对这些库进行链接，最后调用每个依赖库的初始化方法，在这一步，runtime 被初始化。当所有依赖库的初始化后，轮到最后一位（程序可执行文件）进行初始化，在这时 runtime 会对项目中所有类进行类结构初始化，然后调用所有的 load 方法。最后 dyld 返回 main 函数地址，main 函数被调用，我们便来到了熟悉的程序入口。</p>
<p>dyld 启动后将会在可执行文件的 Mach Header 上找到类型为 LC_LOAD_DYLIB 的加载指令，查找需要的动态库，因为每个 dylib 也是 Mach-O 镜像文件，需要执行同可执行文件一样类似映射到内存上，验证 Mach header 等等，并且 dylib 会依赖其他的 dylib，所以 dylibs 加载是一个递归的过程。</p>
<p>针对这一步骤的优化有：</p>
<ol>
<li>减少非系统库的依赖</li>
<li>合并非系统库</li>
<li>检查 CocoaPods 引入库的设置，关闭 use_frameworks! 设置，采用静态引用。</li>
</ol>
<h4 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h4><p>Rebase，是因为 Mach-O 镜像文件加载到内存中的地址和初始地址不同，所以 dyld 需要 Rebase 去进行指针修正。</p>
<h4 id="Binding"><a href="#Binding" class="headerlink" title="Binding"></a>Binding</h4><p>因为动态库不编译进程序最终的二进制文件中，而是在运行的时候动态的查找调用函数的地址，调用外部符号进行绑定的过程就称作  Binding，比如我们 objc 代码中需要使用到 NSObject，即符号 _OBJC_CLASS_$_NSObject，但是这个符号又不在我们的二进制中，在系统库 Foundation.framework 中，因此就需要 binding 这个操作将对应关系绑定到一起</p>
<h4 id="Objc-Setup"><a href="#Objc-Setup" class="headerlink" title="Objc Setup"></a>Objc Setup</h4><p>Objc setup 主要是在 objc_init 完成的，数据修正后将会注册 Objc 的类，如果有分类，还需要将分类定义的方法插入的方法列表中，并且保证每一个 selector 是唯一的.</p>
<h4 id="initializers"><a href="#initializers" class="headerlink" title="initializers"></a>initializers</h4><p>经过上述的步骤之后最后一步就是进行静态初始化工作，例如 Load 函数，如果有 C++ 的一些初始化构造函数也将会被执行。</p>
<h3 id="main-函数执行后"><a href="#main-函数执行后" class="headerlink" title="main() 函数执行后"></a>main() 函数执行后</h3><p>main() 函数执行后，是指从 main() 函数开始，到appDelegate 的 didFinishLaunchingWithOptions 方法里首屏渲染相关方法执行完成的过程。</p>
<p>这个过程主要包括了：</p>
<ol>
<li>日志、统计</li>
<li>配置 APP 运行需要的环境</li>
<li>第三方 SDK 初始化</li>
</ol>
<p>代码中，各种各样的初始化工作，全部都放在这个阶段去执行了，导致渲染缓慢。这里我们能做的优化工作是，从功能上梳理出来，到底哪些才是首屏渲染必要的初始化功能，哪些是 APP 启动必要的初始化功能，其他只需要在对应模块功能使用前才需要初始化的工作，分别放在他们对应的合适的位置。</p>
<p>除此之外，使用 instrument 可以帮助我们进行分析 didFinishLaunchingWithOptions 中的耗时操作。</p>
<h3 id="首屏渲染完成后"><a href="#首屏渲染完成后" class="headerlink" title="首屏渲染完成后"></a>首屏渲染完成后</h3><p>到这个阶段，用户已经看到我们 APP 的首页，这个阶段，所做的事情是其他业务模块的一些初始化工作，也就是 appDelegate 的 didFinishLaunchingWithOptions 方法作用域结束的位置。</p>
<p>所以这个阶段的优化优先级比较低，但是还是要注意，那些会阻塞主线程的操作，以防影响用户后面的操作。</p>
<h3 id="优化工作"><a href="#优化工作" class="headerlink" title="优化工作"></a>优化工作</h3><p>上面每个阶段都说了对应的可以做的优化工作，这里再具体的总结一下。</p>
<h4 id="功能级别的优化"><a href="#功能级别的优化" class="headerlink" title="功能级别的优化"></a>功能级别的优化</h4><p>也许你的项目有很多业务线，每个业务线有分属不同的团队去维护，各个业务线有都有他们各自的初始化工作，可能都放在了启动阶段，倒是启动的滞后，所以这里需要各个团队从功能级别，去梳理出必要的初始化工作，和非必要的工作，从而优化启动速度。</p>
<h4 id="动态库加载方面"><a href="#动态库加载方面" class="headerlink" title="动态库加载方面"></a>动态库加载方面</h4><p>因为主要的动态库都是系统的动态库，而系统本身对其都有相应的优化处理，所以我们能做的只有去掉无用的系统动态库，或者一步到位直接删除掉 Link Binary With Libraries 中的所有系统动态库，改为自动 link 系统动态库</p>
<p><img src="/images/upload/image-20201029102124225.png" alt="image-20201029102124225"></p>
<h4 id="方法级别的优化"><a href="#方法级别的优化" class="headerlink" title="方法级别的优化"></a>方法级别的优化</h4><p>完成了功能级别的优化后，APP 的启动速度应该已经有了一定程度的缩短，下面我们再继续从方法级别去做优化。</p>
<ol>
<li><p>删除无用代码</p>
<p>上面也说过了一个 +load() 方法就会造成 4 毫秒的消耗，那么当我们的项目日渐壮大，业务线交错的时候，也许已经有了很多无用的冗余代码在里面，我们可以使用 <strong>AppCode</strong> 分析检测项目代码。</p>
<blockquote>
<p>因为 AppCode 也会分析 Pods 内部的代码，试了设置了也没用，都会去检测，检测时间非常非常非常的久，所以有个比较取巧的办法就是，先移除 Pods 的代码，单纯的分析工程的代码。</p>
</blockquote>
<p>检测完就需要手动移除无用代码了，但是注意检测结果并不十分准确，比如可能存在一些 runtime 映射的方法，也会被检测到，所以还是要人工再检查一遍，以防误删有用代码。</p>
</li>
<li><p>抽象重复代码<br>在 iOS 代码中可能会为同一个类写很多分类方法，由于参与开发同学较多，可能会导致方法重复，但是实际上运行起来只能有一个分类的方法被调用，这取决于哪个分类后被加载，然而编译的二进制代码中，两个方法应该是都存在的，这不仅会增加 app 体积，也会增加启动时间，所以应该杜绝这样的重复问题；</p>
<p>有很多地方可能是名字不同，但是函数的功能相同，这个不容易被发现，需要大家在写代码的过程中注意；</p>
<p>又或者两个函数名字比较接近，里面有很多相似的代码，这种情况下可以进行相同的代码的提取。</p>
</li>
</ol>
<h3 id="具体实施落地"><a href="#具体实施落地" class="headerlink" title="具体实施落地"></a>具体实施落地</h3><p>以下以苏打优选 App 举例。</p>
<ol>
<li>合并各种定制化功能创建的 Category，减少类数量。</li>
<li>注释 Podfile 文件中的 use_frameworks! 配置，采用静态库方式引入第三方库。</li>
<li>编译线上包时，注释 Podfile 文件中 LookinServer、DoraemonKit、MLeaksFinder 等 Debug 所需的第三方库，及注释 Appdelegate 中的相关代码，减少干扰。</li>
<li>删除冗余代码。</li>
<li>抽象重复代码，可以利用 Xcode 的组合快捷键抽取。</li>
</ol>
<p>优化前后的数据对比（iPhone6s，5次启动平均值，单位 ms ）：</p>
<table>
<thead>
<tr>
<th align="center">统计项</th>
<th align="center">冷启动</th>
<th align="center">热启动</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dylib loading time</td>
<td align="center">699.61</td>
<td align="center">189.30</td>
</tr>
<tr>
<td align="center">rebase&#x2F;binding time</td>
<td align="center">55.01</td>
<td align="center">15.53</td>
</tr>
<tr>
<td align="center">ObjC setup time</td>
<td align="center">47.26</td>
<td align="center">34.8</td>
</tr>
<tr>
<td align="center">initializer time</td>
<td align="center">330.40</td>
<td align="center">320.42</td>
</tr>
<tr>
<td align="center">Total pre-main time</td>
<td align="center">1132.28</td>
<td align="center">560.05</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">统计项</th>
<th align="center">冷启动</th>
<th align="center">热启动</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dylib loading time</td>
<td align="center">39.23</td>
<td align="center">47.57</td>
</tr>
<tr>
<td align="center">rebase&#x2F;binding time</td>
<td align="center">41.28</td>
<td align="center">14.25</td>
</tr>
<tr>
<td align="center">ObjC setup time</td>
<td align="center">32.38</td>
<td align="center">28.83</td>
</tr>
<tr>
<td align="center">initializer time</td>
<td align="center">317.41</td>
<td align="center">215.59</td>
</tr>
<tr>
<td align="center">Total pre-main time</td>
<td align="center">430.31</td>
<td align="center">306.25</td>
</tr>
</tbody></table>
<p>通过数据对比，能看到优化后启动速度提升明显，启动耗时差不多减半，冷启动提升高达 62%，热启动提升也有 35%。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/11/19/git-clone%E9%80%9F%E5%BA%A6%E5%A4%AA%E6%85%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/11/19/git-clone%E9%80%9F%E5%BA%A6%E5%A4%AA%E6%85%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">git clone速度太慢解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-19 11:18:27" itemprop="dateCreated datePublished" datetime="2019-11-19T11:18:27+08:00">2019-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-08 15:21:00" itemprop="dateModified" datetime="2020-12-08T15:21:00+08:00">2020-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>适用各种操作系统，本次测试于ubuntu，下载速度从二十几k提高到二百多k</p>
<p>1、查找域名对应的ip地址，并修改hosts文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup github.global.ssl.fastly.Net</span><br><span class="line">nslookup github.com</span><br></pre></td></tr></table></figure>

<p>将下列内容加入 &#x2F;etc&#x2F;hosts文件中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">151.101.76.249 http://global-ssl.fastly.net</span><br><span class="line">192.30.255.113 http://github.com  #此处112还是113根据自己的情况调整？</span><br></pre></td></tr></table></figure>

<p>2、 刷新DNS缓存<br>linux：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/networking restart</span><br></pre></td></tr></table></figure>

<p>windows：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /flushdns</span><br></pre></td></tr></table></figure>

<p>macOS:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure>

<p>参考：<br><a target="_blank" rel="noopener" href="http://www.linuxidc.com/Linux/2017-10/148116.htm">http://www.linuxidc.com/Linux/2017-10/148116.htm</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/blgmh/article/details/74531982">http://blog.csdn.net/blgmh/article/details/74531982</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/25/UIApplicationDelegate%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E9%A1%BA%E5%BA%8F%EF%BC%88iOS-12%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/25/UIApplicationDelegate%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E9%A1%BA%E5%BA%8F%EF%BC%88iOS-12%EF%BC%89/" class="post-title-link" itemprop="url">UIApplicationDelegate方法调用顺序（iOS 12）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-25 12:30:00" itemprop="dateCreated datePublished" datetime="2019-03-25T12:30:00+08:00">2019-03-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-08 15:21:00" itemprop="dateModified" datetime="2020-12-08T15:21:00+08:00">2020-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文将作为iOS上响应某些操作调用UIApplicationDelegate方法的顺序的指南。除非另有说明，否则本文内容基于iOS 12.1。</p>
</blockquote>
<h3 id="正常启动"><a href="#正常启动" class="headerlink" title="正常启动"></a>正常启动</h3><ol>
<li><code>application(_:willFinishLaunchingWithOptions:)</code></li>
<li><code>application(_:didFinishLaunchingWithOptions:)</code></li>
<li><code>applicationDidBecomeActive</code></li>
</ol>
<h3 id="正常打开"><a href="#正常打开" class="headerlink" title="正常打开"></a>正常打开</h3><ol>
<li><code>applicationWillEnterForeground</code></li>
<li><code>applicationDidBecomeActive</code></li>
</ol>
<h3 id="通过URL-scheme启动"><a href="#通过URL-scheme启动" class="headerlink" title="通过URL scheme启动"></a>通过URL scheme启动</h3><ol>
<li><p><code>application(_:willFinishLaunchingWithOptions:)</code></p>
<p>示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">UIApplicationLaunchOptionsSourceApplicationKey</span>: <span class="string">&quot;com.apple.mobilesafari&quot;</span>,</span><br><span class="line">  <span class="built_in">UIApplicationLaunchOptionsURLKey</span>: <span class="string">&quot;test://test.com&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>application(_:didFinishLaunchingWithOptions:)</code></p>
</li>
<li><p>[如果 1 和 2 都返回 true] <code>application(_:open:options:)</code></p>
</li>
<li><p><code>applicationDidBecomeActive</code></p>
</li>
</ol>
<h3 id="通过URL-scheme打开"><a href="#通过URL-scheme打开" class="headerlink" title="通过URL scheme打开"></a>通过URL scheme打开</h3><ol>
<li><code>applicationWillEnterForeground</code></li>
<li><code>application(_:open:options:)</code></li>
<li><code>applicationDidBecomeActive</code></li>
</ol>
<h3 id="通过universal-link启动"><a href="#通过universal-link启动" class="headerlink" title="通过universal link启动"></a>通过universal link启动</h3><ol>
<li><p><code>application(_:willFinishLaunchingWithOptions:)</code></p>
<p>示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">UIApplicationLaunchOptionsUserActivityDictionaryKey</span>: &#123;</span><br><span class="line">    <span class="built_in">UIApplicationLaunchOptionsUserActivityIdentifierKey</span>: <span class="string">&quot;F42C288E-D721-4F5D-9AB5-4FEB1D634D99&quot;</span>,</span><br><span class="line">    <span class="built_in">UIApplicationLaunchOptionsUserActivityKey</span>: <span class="string">&quot;&lt;NSUserActivity: 0x2827146a0&gt;&quot;</span>,</span><br><span class="line">    <span class="built_in">UIApplicationLaunchOptionsUserActivityTypeKey</span>: <span class="built_in">NSUserActivityTypeBrowsingWeb</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">UIApplicationLaunchOptionsSourceApplicationKey</span>: <span class="string">&quot;com.apple.mobilesafari&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>application(_:didFinishLaunchingWithOptions:)</code></p>
</li>
<li><p>[如果 1 和 2 都返回 true] <code>application(_:willContinueUserActivityWithType:)</code></p>
</li>
<li><p>[如果 1 和 2 都返回 true] <code>application(_:continue:restorationHandler:)</code></p>
</li>
<li><p><code>applicationDidBecomeActive</code></p>
</li>
</ol>
<h3 id="通过universal-link打开"><a href="#通过universal-link打开" class="headerlink" title="通过universal link打开"></a>通过universal link打开</h3><ol>
<li><code>applicationWillEnterForeground</code></li>
<li><code>application(_:willContinueUserActivityWithType:):</code></li>
<li><code>application(_:continue:restorationHandler:):</code></li>
<li><code>applicationDidBecomeActive</code></li>
</ol>
<h3 id="通过推送启动"><a href="#通过推送启动" class="headerlink" title="通过推送启动"></a>通过推送启动</h3><ol>
<li><p><code>application(_:willFinishLaunchingWithOptions:)</code></p>
<p>示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">UIApplicationLaunchOptionsRemoteNotificationKey</span>: &#123;</span><br><span class="line">    aps = &#123;</span><br><span class="line">      alert = <span class="string">&quot;Testing.. (0)&quot;</span>;</span><br><span class="line">      badge = <span class="number">1</span>;</span><br><span class="line">      sound = <span class="keyword">default</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>application(_:didFinishLaunchingWithOptions:)</code></p>
</li>
<li><p><code>userNotificationCenter(_:didReceive:withCompletionHandler:)</code></p>
</li>
<li><p><code>applicationDidBecomeActive</code></p>
</li>
</ol>
<h3 id="通过推送打开"><a href="#通过推送打开" class="headerlink" title="通过推送打开"></a>通过推送打开</h3><ol>
<li><code>applicationWillEnterForeground</code></li>
<li><code>userNotificationCenter(_:didReceive:withCompletionHandler:)</code></li>
<li><code>applicationDidBecomeActive</code></li>
</ol>
<h3 id="通过快捷方式启动"><a href="#通过快捷方式启动" class="headerlink" title="通过快捷方式启动"></a>通过快捷方式启动</h3><ol>
<li><p><code>application(_:willFinishLaunchingWithOptions:)</code></p>
<p>示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">UIApplicationLaunchOptionsShortcutItemKey</span>: &lt;<span class="built_in">UIApplicationShortcutItem</span>: <span class="number">0x283ef6e00</span>; type: com.recoursive.example.shortcutTest, title: Shortcut test&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>application(_:didFinishLaunchingWithOptions:)</code></p>
</li>
<li><p>[如果 1 和 2 都返回 true] <code>application(_:performActionFor:completionHandler:)</code></p>
</li>
<li><p><code>applicationDidBecomeActive</code></p>
</li>
</ol>
<h3 id="通过快捷方式打开"><a href="#通过快捷方式打开" class="headerlink" title="通过快捷方式打开"></a>通过快捷方式打开</h3><ol>
<li><code>applicationWillEnterForeground</code></li>
<li><code>application(_:performActionFor:completionHandler:)</code></li>
<li><code>applicationDidBecomeActive</code></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E5%85%B3%E4%BA%8EUITableView%E7%9A%84%E5%87%A0%E4%B8%AA%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Darren Kong">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DarrenKong's Blog">
      <meta itemprop="description" content="Stay hungry，stay foolish!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DarrenKong's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E5%85%B3%E4%BA%8EUITableView%E7%9A%84%E5%87%A0%E4%B8%AA%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91/" class="post-title-link" itemprop="url">关于UITableView的几个优化方向</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 14:57:24" itemprop="dateCreated datePublished" datetime="2019-03-11T14:57:24+08:00">2019-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-08 15:21:00" itemprop="dateModified" datetime="2020-12-08T15:21:00+08:00">2020-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>如何优化复杂的UITableView卡顿的问题, 一般可以从以下几个方向着手优化：</p>
<ol>
<li><p><code>cell</code> 的行高不是固定值，需要计算，则要尽可能缓存行高值，避免重复计算行高。因为 <code>heightForRowAtIndexPath:</code>是调用最频繁的方法。</p>
</li>
<li><p>滑动时按需加载，这个在大量图片展示，网络加载的时候很管用!(<code>SDWebImage</code> 已经实现异 步加载，配合这条性能杠杠的)。</p>
</li>
<li><p>正确使用 <code>reuseIdentifier</code> 来重用 <code>Cells</code></p>
</li>
<li><p>尽量少用或不用透明图层</p>
</li>
<li><p>如果 <code>Cell</code> 内现实的内容来自 <code>web</code>，使用异步加载，缓存请求结果</p>
</li>
<li><p>减少 <code>subviews</code> 的数量</p>
</li>
<li><p>在 <code>heightForRowAtIndexPath:</code>中尽量不使用 <code>cellForRowAtIndexPath:</code>，如果你需要用到它， 只用一次然后缓存结果</p>
</li>
<li><p>所有的子视图都预先创建，如果不需要显示可以设置 <code>hidden</code>，尽量少动态给 <code>Cell</code> 添加 <code>View</code></p>
</li>
<li><p>颜色不要使用 <code>alph</code></p>
</li>
<li><p>栅格化</p>
</li>
<li><p><code>cell</code> 的 <code>subViews</code> 的各级 <code>opaque</code> 值要设成 YES，尽量不要包含透明的子 <code>View</code> <code>opaque</code> 用于辅助绘图系统，表示 <code>UIView</code> 是否透明。在不透明的情况下，渲染视图时需要快速 地渲染，以提􏰀高性能。渲染最慢的操作之一是混合<code>(blending</code>)。提􏰀高性能的方法是减少混合操 作的次数，其实就是 <code>GPU</code> 的不合理使用，这是硬件来完成的(混合操作由 <code>GPU</code> 来执行，因为这 个硬件就是用来做混合操作的，当然不只是混合)。 优化混合操作的关键点是在平衡 <code>CPU</code> 和 <code>GPU</code> 的负载。还有就是 <code>cell</code> 的 <code>layer</code> 的 <code>shouldRasterize</code> 要设成 <code>YES</code>。</p>
</li>
<li><p><code>cell</code> 异步加载图片以及缓存</p>
</li>
<li><p>异步绘制</p>
</li>
</ol>
<ul>
<li><p>(1)在绘制字符串时，尽可能使用 <code>drawAtPoint: withFont:</code>，而不要使用更复杂的 <code>drawAtPoint:(CGPoint)point forWidth:(CGFloat)width withFont:(UIFont *)font lineBreakMode:(UILineBreakMode)lineBreakMode</code>; 如果要绘制过长的字符串，建议自己先截 断，然后使用 <code>drawAtPoint: withFont:</code>方法绘制。</p>
</li>
<li><p>(2)在绘制图片时，尽量使用 <code>drawAtPoint</code>，而不要使用 <code>drawInRect</code>。<code>drawInRect</code> 如果在绘 制过程中对图片进行放缩，会特别消耗 <code>CPU</code>。</p>
</li>
<li><p>(3)其实，最快的绘制就是你不要做任何绘制。有时通过 <code>UIGraphicsBeginImageContextWithOptions()</code> 或者 <code>CGBitmapContextCeate()</code> 创建位图会显 得更有意义，从位图上面抓取图像，并设置为 <code>CALayer</code> 的内容。 如果你必须实现 <code>-drawRect:</code>，并且你必须绘制大量的东西，这将占用时间。</p>
</li>
<li><p>(4)如果绘制 <code>cell</code> 过程中，需要下载 <code>cell</code> 中的图片，建议在绘制 <code>cell</code> 一段时间后再开启图 片下载任务。譬如先画一个默认图片，然后在 0.5S 后开始下载本 <code>cell</code> 的图片。</p>
</li>
<li><p>(5)即使下载 <code>cell</code> 图片是在子线程中进行，在绘制 <code>cell</code> 过程中，也不能开启过多的子线程。 最好只有一个下载图片的子线程在活动。否则也会影响 <code>UITableViewCell</code> 的绘制，因而影响了 <code>UITableViewCell</code> 的滑动速度。(建议结合使用 <code>NSOpeartion</code> 和 <code>NSOperationQueue</code> 来下载图片， 如果想尽可能找的下载图片，可以把<code>[self.queuesetMaxConcurrentOperationCount:4];</code>)</p>
</li>
<li><p>(6)最好自己写一个 <code>cache</code>，用来缓存 <code>UITableView</code> 中的 <code>UITableViewCell</code>，这样在整个 <code>UITableView</code> 的生命周期里，一个 <code>cell</code> 只需绘制一次，并且如果发生内存不足，也可以有效的 释放掉缓存的 <code>cell</code>。</p>
</li>
</ul>
<ol start="14">
<li>不要将 <code>tableview</code> 的背景颜色设置成一个图片。这回严重影响 <code>UITableView</code> 的滑动速度。我曾经翻过一个错误：<code>self.tableView.backgroundColor = [UIColorcolorWithPatternImage:[UIImageimageNamed:@&quot;background.png&quot;]];</code> 通过这种方式设置 <code>UITableView</code> 的背景颜色会严重影响 UTIableView 的滑动流畅性。修改成 <code>self.tableView.backgroundColor = [UIColor clearColor];</code>之后，<code>fps</code> 从 <code>43</code> 上升到 <code>60</code> 左右。 滑动比较流畅。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Darren Kong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/DarrenKong" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
