---
title: 关于Cocoapods Spec仓库目录结构
date: 2019-01-22 16:29:45
tags: 
    - CocoaPods
categories:
    - CocoaPods
---

前阵子项目重构，使用private-specs时看到CocoaPods Specs的目录结构有改变，与我最初使用CocoaPods时的目录结构不同，具体见下图。

![](/images/upload/1.jpg)

Specs目录下，并不是直接是以库的名称来命名文件夹，而是分3层目录，每层以0-f来命名。比如YYKit的位置是../a/4/0/YYKit/1.0.9/YYKit.podspec.json。

看到这个结构，回想毕业后参与的第一个商业项目（一个文件存储相关的项目，涉及到文件的同步、协作、合并、比对等操作，有点类似三五年前使用比较多的SVN版本工具的文件系统功能）。第一个版本的实现方案是一个文件目录下存放所有文件，项目上线后，收到很多用户反馈说这样的文件夹结构，在Windows系统下打开文件夹会比较卡。项目经理（一个建筑类专业的博士）要求我按照他说的优化思路优化。他思路是文件名MD5，取前3位，每一位分一级目录，这与Cocoapods的specs仓库文件夹结构是一致的。
按照项目经理的思路实现后，确实打开速度快了很多。我也去了解了Windows系统的一个文件夹最多能存放多少个文件、文件名长度要求多少位以内等相关问题。

> Windows系统下，一个文件夹下能存多少个文件，与硬盘格式有直接关系。FAT：512个，FAT32： 65,534个，NTFS ：4,294,967,295个。

CocoaPodsd的specs目录分3级，可能也有上面这个原因的考虑。另外，考虑到有些网站需要展示文件夹的文件列表，分3级，每个文件夹下的库数量就不会很多，读取、渲染文件夹的结构也相对会快一些。还有一个原因是，在终端中使用find命令查找文件夹下的指定文件，查找得出结果需要花好几秒。分3级目录，相当于把之前一个文件下的文件分散到4,096个文件夹下，速度会相应有一定提升。

至于按照什么规则去分散到对应文件夹下，这个是讲仓库名MD5，取前3位，每一位分一级目录。比如YYKit，使用MD5加密后得到a408542eb2fcd3c332bf83b515cdcf03，对应的目录就是/a/4/0/，再加上YYKit、YYKit的版本号，拼接后最终得到../a/4/0/YYKit/1.0.9/YYKit.podspec.json。

而我们自己见的私有specs仓库，一般只有一级目录。这主要是私人specs仓库没那么多仓库，也就不需要区分多级目录。Cocoapods中的specs仓库是全世界各地使用者提交，这个specs实在是太大，如果都平级的话，找起来效率不高，并且很麻烦。